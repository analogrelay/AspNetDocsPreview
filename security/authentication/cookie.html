

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Cookie Middleware without ASP.NET Core Identity &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../../index.html"/>
        <link rel="up" title="Authentication" href="index.html"/>
        <link rel="next" title="Azure Active Directory" href="azure-active-directory/index.html"/>
        <link rel="prev" title="ðŸ”§ Supporting Third Party Clients using OAuth 2.0" href="oauth2.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Security</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Authentication</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="identity.html">Introduction to Identity</a></li>
<li class="toctree-l3"><a class="reference internal" href="sociallogins.html">Enabling authentication using Facebook, Google and other external providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="accconfirm.html">Account Confirmation and Password Recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="2fa.html">Two-factor authentication with SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="oauth2.html">ðŸ”§ Supporting Third Party Clients using OAuth 2.0</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using Cookie Middleware without ASP.NET Core Identity</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure-active-directory/index.html">Azure Active Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../authorization/index.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-protection/index.html">Data Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-secrets.html">Safe storage of app secrets during development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enforcing-ssl.html">ðŸ”§ Enforcing SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../anti-request-forgery.html">ðŸ”§ Anti-Request Forgery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../open-redirect.html">ðŸ”§ Preventing Open Redirect Attacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross-site-scripting.html">ðŸ”§ Preventing Cross-Site Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cors.html">Enabling Cross-Origin Requests (CORS)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Security</a> &raquo;</li>
      
          <li><a href="index.html">Authentication</a> &raquo;</li>
      
    <li>Using Cookie Middleware without ASP.NET Core Identity</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/security/authentication/cookie.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="using-cookie-middleware-without-asp-net-core-identity">
<span id="security-authentication-cookie-middleware"></span><h1>Using Cookie Middleware without ASP.NET Core Identity<a class="headerlink" href="#using-cookie-middleware-without-asp-net-core-identity" title="Permalink to this headline">Â¶</a></h1>
<p>ASP.NET Core provides cookie <a class="reference internal" href="../../fundamentals/middleware.html#fundamentals-middleware"><span class="std std-ref">middleware</span></a> which serializes a user principal into an encrypted cookie and then, on subsequent requests, validates the cookie, recreates the principal and assigns it to the <code class="docutils literal"><span class="pre">User</span></code> property on <code class="docutils literal"><span class="pre">HttpContext</span></code>. If you want to provide your own login screens and user databases you can use the cookie middleware as a standalone feature.</p>
<div class="section" id="adding-and-configuring">
<span id="security-authentication-cookie-middleware-configuring"></span><h2>Adding and configuring<a class="headerlink" href="#adding-and-configuring" title="Permalink to this headline">Â¶</a></h2>
<p>The first step is adding the cookie middleware to your application. First use nuget to add the <code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Authentication.Cookies</span></code> package. Then add the following lines to the <code class="docutils literal"><span class="pre">Configure</span></code> method in your <em>Startup.cs</em> file;</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">app</span><span class="p">.</span><span class="n">UseCookieAuthentication</span><span class="p">(</span><span class="k">new</span> <span class="n">CookieAuthenticationOptions</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">AuthenticationScheme</span> <span class="p">=</span> <span class="s">&quot;MyCookieMiddlewareInstance&quot;</span><span class="p">,</span>
    <span class="n">LoginPath</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PathString</span><span class="p">(</span><span class="s">&quot;/Account/Unauthorized/&quot;</span><span class="p">),</span>
    <span class="n">AccessDeniedPath</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PathString</span><span class="p">(</span><span class="s">&quot;/Account/Forbidden/&quot;</span><span class="p">),</span>
    <span class="n">AutomaticAuthenticate</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
    <span class="n">AutomaticChallenge</span> <span class="p">=</span> <span class="k">true</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The code snippet above configures a few options;</p>
<ul class="simple">
<li>AuthenticationScheme - this is a value by which the middleware is known. This is useful when there are multiple instances of middleware and you want to <a class="reference internal" href="../authorization/limitingidentitybyscheme.html#security-authorization-limiting-by-scheme"><span class="std std-ref">limit authorization to one instance</span></a>.</li>
<li>LoginPath - this is the relative path requests will be redirected to when a user attempts to access a resource but has not been authenticated.</li>
<li>AccessDeniedPath - this is the relative path requests will be redirected to when a user attempts to access a resource but does not pass any <a class="reference internal" href="../authorization/policies.html#security-authorization-policies-based"><span class="std std-ref">authorization policies</span></a> for that resource.</li>
<li>AutomaticAuthenticate - this flag indicates that the middleware should run on every request and attempt to validate and reconstruct any serialized principal it created.</li>
<li>AutomaticChallenge - this flag indicates that the middleware should redirect the browser to the <code class="docutils literal"><span class="pre">LoginPath</span></code> or <code class="docutils literal"><span class="pre">AccessDeniedPath</span></code> when authorization fails.</li>
</ul>
<p><a class="reference internal" href="#security-authentication-cookie-options"><span class="std std-ref">Other options</span></a> include the ability to set the issuer for any claims the middleware creates, the name of the cookie the middleware drops, the domain for the cookie and various security properties on the cookie. By default the cookie middleware will use appropriate security options for any cookies it creates, setting HTTPONLY to avoid the cookie being accessible in client side JavaScript and limiting the cookie to HTTPS if a request has come over HTTPS.</p>
</div>
<div class="section" id="creating-an-identity-cookie">
<span id="security-authentication-cookie-middleware-creating-a-cookie"></span><h2>Creating an identity cookie<a class="headerlink" href="#creating-an-identity-cookie" title="Permalink to this headline">Â¶</a></h2>
<p>To create a cookie holding your user information you must construct a <a class="reference external" href="https://msdn.microsoft.com/en-us/library/system.security.claims.claimsprincipal(v=vs.110).aspx">ClaimsPrincipal</a> holding the information you wish to be serialized in the cookie. Once you have a suitable <cite>ClaimsPrincipal</cite> inside your controller method call</p>
<blockquote>
<div><div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Authentication</span><span class="p">.</span><span class="n">SignInAsync</span><span class="p">(</span><span class="s">&quot;MyCookieMiddlewareInstance&quot;</span><span class="p">,</span> <span class="n">principal</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>This will create an encrypted cookie and add it to the current response. The <code class="docutils literal"><span class="pre">AuthenticationScheme</span></code> specified during <a class="reference internal" href="#security-authentication-cookie-middleware-configuring"><span class="std std-ref">configuration</span></a> must also be used when calling <code class="docutils literal"><span class="pre">SignInAsync</span></code>.</p>
<p>Under the covers the encryption used is ASP.NET&#8217;s <a class="reference internal" href="../data-protection/using-data-protection.html#security-data-protection-getting-started"><span class="std std-ref">Data Protection</span></a> system. If you are hosting on multiple machines, load balancing or using a web farm then you will need to <a class="reference internal" href="../data-protection/configuration/overview.html#data-protection-configuring"><span class="std std-ref">configure</span></a> data protection to use the same key ring and application identifier.</p>
</div>
<div class="section" id="signing-out">
<h2>Signing out<a class="headerlink" href="#signing-out" title="Permalink to this headline">Â¶</a></h2>
<p>To sign out the current user, and delete their cookie call the following inside your controller</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Authentication</span><span class="p">.</span><span class="n">SignOutAsync</span><span class="p">(</span><span class="s">&quot;MyCookieMiddlewareInstance&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="reacting-to-back-end-changes">
<h2>Reacting to back-end changes<a class="headerlink" href="#reacting-to-back-end-changes" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Once a principal cookie has been created it becomes the single source of identity - even if you disable a user in your back-end systems the cookie middleware has no knowledge of this and a user will continue to stay logged in as long as their cookie is valid.</p>
</div>
<p>The cookie authentication middleware provides a series of Events in its option class. The <code class="docutils literal"><span class="pre">ValidateAsync()</span></code> event can be used to intercept and override validation of the cookie identity.</p>
<p>Consider a back-end user database that may have a LastChanged column. In order to invalidate a cookie when the database changes you should first, when <a class="reference internal" href="#security-authentication-cookie-middleware-creating-a-cookie"><span class="std std-ref">creating the cookie</span></a>, add a LastChanged claim containing the current value. Then, when the database changes the LastChanged value should also be updated.</p>
<p>To implement an override for the <code class="docutils literal"><span class="pre">ValidateAsync()</span></code> event you must write a method with the following signature;</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">Task</span> <span class="nf">ValidateAsync</span><span class="p">(</span><span class="n">CookieValidatePrincipalContext</span> <span class="n">context</span><span class="p">);</span>
</pre></div>
</div>
<p>ASP.NET Core Identity implements this check as part of its <a class="reference external" href="https://docs.asp.net/projects/api/en/latest/autoapi/Microsoft/AspNetCore/Identity/SecurityStampValidator/index.html">SecurityStampValidator</a>. A simple example would look something like as follows;</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">LastChangedValidator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">ValidateAsync</span><span class="p">(</span><span class="n">CookieValidatePrincipalContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Pull database from registered DI services.</span>
        <span class="kt">var</span> <span class="n">userRepository</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">RequestServices</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">IUserRepository</span><span class="p">&gt;();</span>
        <span class="kt">var</span> <span class="n">userPrincipal</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Principal</span><span class="p">;</span>

        <span class="c1">// Look for the last changed claim.</span>
        <span class="kt">string</span> <span class="n">lastChanged</span><span class="p">;</span>
        <span class="n">lastChanged</span> <span class="p">=</span> <span class="p">(</span><span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">userPrincipal</span><span class="p">.</span><span class="n">Claims</span>
                       <span class="k">where</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">&quot;LastUpdated&quot;</span>
                       <span class="k">select</span> <span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">FirstOrDefault</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">lastChanged</span><span class="p">)</span> <span class="p">||</span>
            <span class="p">!</span><span class="n">userRepository</span><span class="p">.</span><span class="n">ValidateLastChanged</span><span class="p">(</span><span class="n">userPrincipal</span><span class="p">,</span> <span class="n">lastChanged</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">context</span><span class="p">.</span><span class="n">RejectPrincipal</span><span class="p">();</span>
            <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">Authentication</span><span class="p">.</span><span class="n">SignOutAsync</span><span class="p">(</span><span class="s">&quot;MyCookieMiddlewareInstance&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This would then be wired up during cookie middleware configuration</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">app</span><span class="p">.</span><span class="n">UseCookieAuthentication</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">Events</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CookieAuthenticationEvents</span>
    <span class="p">{</span>
        <span class="c1">// Set other options</span>
        <span class="n">OnValidatePrincipal</span> <span class="p">=</span> <span class="n">LastChangedValidator</span><span class="p">.</span><span class="n">ValidateAsync</span>
    <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If you want to non-destructively update the user principal, for example, their name might have been updated, a decision which doesn&#8217;t affect security in any way you can call <code class="docutils literal"><span class="pre">context.ReplacePrincipal()</span></code> and set the <code class="docutils literal"><span class="pre">context.ShouldRenew</span></code> flag to <code class="docutils literal"><span class="pre">true</span></code>.</p>
</div>
<div class="section" id="controlling-cookie-options">
<span id="security-authentication-cookie-options"></span><h2>Controlling cookie options<a class="headerlink" href="#controlling-cookie-options" title="Permalink to this headline">Â¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">CookieAuthenticationOptions</span></code> class comes with various configuration options to enable you to fine tune the cookies created.</p>
<ul class="simple">
<li><strong>ClaimsIssuer</strong> - the issuer to be used for the <a class="reference external" href="https://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claim.issuer.aspx">Issuer</a> property on any claims created by the middleware.</li>
<li><strong>CookieDomain</strong> - the domain name the cookie will be served to. By default this is the host name the request was sent to. The browser will only serve the cookie to a matching host name. You may wish to adjust this to have cookies available to any host in your domain. For example setting the cookie domain to <code class="docutils literal"><span class="pre">.contoso.com</span></code> will make it available to <code class="docutils literal"><span class="pre">contoso.com</span></code>, <code class="docutils literal"><span class="pre">www.contoso.com</span></code>, <code class="docutils literal"><span class="pre">staging.www.contoso.com</span></code> etc.</li>
<li><strong>CookieHttpOnly</strong> - a flag indicating if the cookie should only be accessible to servers. This defaults to <code class="docutils literal"><span class="pre">true</span></code>. Changing this value may open your application to cookie theft should your application have a Cross Site Scripting bug.</li>
<li><strong>CookiePath</strong> - this can be used to isolate applications running on the same host name. If you have an app running in <code class="docutils literal"><span class="pre">/app1</span></code> and want to limit the cookies issued to just be sent to that application then you should set the <code class="docutils literal"><span class="pre">CookiePath</span></code> property to <code class="docutils literal"><span class="pre">/app1</span></code>. The cookie will now only be available to requests to <code class="docutils literal"><span class="pre">/app1</span></code> or anything underneath it.</li>
<li><strong>CookieSecure</strong> - a flag indicating if the cookie created should be limited to HTTPS, HTTP or HTTPS, or the same protocol as the request. This defaults to <code class="docutils literal"><span class="pre">SameAsRequest</span></code>.</li>
<li><strong>ExpireTimeSpan</strong> - the <code class="docutils literal"><span class="pre">TimeSpan</span></code> after which the cookie will expire. This is added to the current date and time to create the expiry date for the cookie.</li>
<li><strong>SlidingExpiration</strong> - a flag indicating if the cookie expiration date will be reset when the more than half of the <code class="docutils literal"><span class="pre">ExpireTimeSpan</span></code> interval has passed. The new expiry date will be moved forward to be the current date plus the <code class="docutils literal"><span class="pre">ExpireTimespan</span></code>. An <a class="reference internal" href="#security-authentication-absolute-expiry"><span class="std std-ref">absolute expiry time</span></a> can be set by using the <code class="docutils literal"><span class="pre">AuthenticationProperties</span></code> class when calling <code class="docutils literal"><span class="pre">SignInAsync</span></code>. An absolute expiry can improve the security of your application by limiting the amount of time for which the authentication cookie is valid.</li>
</ul>
</div>
<div class="section" id="persistent-cookies-and-absolute-expiry-times">
<h2>Persistent cookies and absolute expiry times<a class="headerlink" href="#persistent-cookies-and-absolute-expiry-times" title="Permalink to this headline">Â¶</a></h2>
<p>You may want to make the cookie expire be remembered over browser sessions. You may also want an absolute expiry to the identity and the cookie transporting it. You can do these things by using the <code class="docutils literal"><span class="pre">AuthenticationProperties</span></code> parameter on the <code class="docutils literal"><span class="pre">HttpContext.Authentication.SignInAsync</span></code> method called when <a class="reference internal" href="#security-authentication-cookie-middleware-creating-a-cookie"><span class="std std-ref">signing in an identity and creating the cookie</span></a>. The <code class="docutils literal"><span class="pre">AuthenticationProperties</span></code> class is in the <code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Http.Authentication</span></code> namespace.</p>
<p>For example;</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Authentication</span><span class="p">.</span><span class="n">SignInAsync</span><span class="p">(</span>
    <span class="s">&quot;MyCookieMiddlewareInstance&quot;</span><span class="p">,</span>
    <span class="n">principal</span><span class="p">,</span>
    <span class="k">new</span> <span class="n">AuthenticationProperties</span>
    <span class="p">{</span>
        <span class="n">IsPersistent</span> <span class="p">=</span> <span class="k">true</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>This code snippet will create an identity and corresponding cookie which will be survive through browser closures.Any sliding expiration settings previously configured via <a class="reference internal" href="#security-authentication-cookie-options"><span class="std std-ref">cookie options</span></a> will still be honored, if the cookie expires whilst the browser is closed the browser will clear it once it is restarted.</p>
<div class="highlight-c#" id="security-authentication-absolute-expiry"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Authentication</span><span class="p">.</span><span class="n">SignInAsync</span><span class="p">(</span>
    <span class="s">&quot;MyCookieMiddlewareInstance&quot;</span><span class="p">,</span>
    <span class="n">principal</span><span class="p">,</span>
    <span class="k">new</span> <span class="n">AuthenticationProperties</span>
    <span class="p">{</span>
        <span class="n">ExpiresUtc</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="n">AddMinutes</span><span class="p">(</span><span class="m">20</span><span class="p">)</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>This code snippet will create an identity and corresponding cookie which will be last for 20 minutes. This ignores any sliding expiration settings previously configured via <a class="reference internal" href="#security-authentication-cookie-options"><span class="std std-ref">cookie options</span></a>.</p>
<p>The ExpiresUtc and IsPersistent properties are mutually exclusive.</p>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="azure-active-directory/index.html" class="btn btn-neutral float-right" title="Azure Active Directory" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="oauth2.html" class="btn btn-neutral" title="ðŸ”§ Supporting Third Party Clients using OAuth 2.0" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>