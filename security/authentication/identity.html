

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to Identity &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../../index.html"/>
        <link rel="up" title="Authentication" href="index.html"/>
        <link rel="next" title="Enabling authentication using Facebook, Google and other external providers" href="sociallogins.html"/>
        <link rel="prev" title="Authentication" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Security</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Authentication</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction to Identity</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sociallogins.html">Enabling authentication using Facebook, Google and other external providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="accconfirm.html">Account Confirmation and Password Recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="2fa.html">Two-factor authentication with SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="oauth2.html">ðŸ”§ Supporting Third Party Clients using OAuth 2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="cookie.html">Using Cookie Middleware without ASP.NET Core Identity</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure-active-directory/index.html">Azure Active Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../authorization/index.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-protection/index.html">Data Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-secrets.html">Safe storage of app secrets during development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enforcing-ssl.html">ðŸ”§ Enforcing SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../anti-request-forgery.html">ðŸ”§ Anti-Request Forgery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../open-redirect.html">ðŸ”§ Preventing Open Redirect Attacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross-site-scripting.html">ðŸ”§ Preventing Cross-Site Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cors.html">Enabling Cross-Origin Requests (CORS)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Security</a> &raquo;</li>
      
          <li><a href="index.html">Authentication</a> &raquo;</li>
      
    <li>Introduction to Identity</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/security/authentication/identity.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="introduction-to-identity">
<h1>Introduction to Identity<a class="headerlink" href="#introduction-to-identity" title="Permalink to this headline">Â¶</a></h1>
<p>By <a class="reference external" href="https://github.com/rustd">Pranav Rastogi</a>, <a class="reference external" href="https://twitter.com/RickAndMSFT">Rick Anderson</a>, Tom Dykstra, Jon Galloway and <a class="reference external" href="https://github.com/Erikre">Erik Reitan</a></p>
<p>ASP.NET Core Identity is a membership system which allows you to add login functionality to your application. Users can create an account and login with a user name and password or they can use an external login providers such as Facebook, Google, Microsoft Account, Twitter and more.</p>
<p>You can configure ASP.NET Core Identity to use a SQL Server database to store user names, passwords, and profile data. Alternatively, you can use your own persistent store to store data in another other persistent storage, such as Azure Table Storage.</p>
<div class="section" id="overview-of-identity">
<h2>Overview of Identity<a class="headerlink" href="#overview-of-identity" title="Permalink to this headline">Â¶</a></h2>
<p>In this topic, you&#8217;ll learn how to use ASP.NET Core Identity to add functionality to register, log in, and log out a user. You can follow along step by step or just read the details. For more detailed instructions about creating apps using ASP.NET Core Identity, see the Next Steps section at the end of this article.</p>
<ol class="arabic simple">
<li>Create an ASP.NET Core Web Application project in Visual Studio with Individual User Accounts.</li>
</ol>
<blockquote>
<div><p>In Visual Studio, select <strong>File</strong> -&gt; <strong>New</strong> -&gt; <strong>Project</strong>. Then, select the <strong>ASP.NET Web Application</strong> from the <strong>New Project</strong> dialog box. Continue by selecting an ASP.NET Core <strong>Web Application</strong> with <strong>Individual User Accounts</strong> as the authentication method.</p>
<img alt="../../_images/01-mvc.png" src="../../_images/01-mvc.png" />
<p>The created project contains the <code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Identity.EntityFrameworkCore</span></code> package, which will persist the identity data and schema to SQL Server using <a class="reference external" href="https://docs.efproject.net">Entity Framework Core</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Visual Studio, you can view NuGet packages details by selecting <strong>Tools</strong> -&gt; <strong>NuGet Package Manager</strong> -&gt; <strong>Manage NuGet Packages for Solution</strong>. You also see a list of packages in the dependencies section of the <em>project.json</em> file within your project.</p>
</div>
<p>The identity services are added to the application in the <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method in the <code class="docutils literal"><span class="pre">Startup</span></code> class:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="c1">// This method gets called by the runtime. Use this method to add services to the container.</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Add framework services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddEntityFramework</span><span class="p">()</span>
        <span class="p">.</span><span class="n">AddSqlServer</span><span class="p">()</span>
        <span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
            <span class="n">options</span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">&quot;Data:DefaultConnection:ConnectionString&quot;</span><span class="p">]));</span>

<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddIdentity</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">,</span> <span class="n">IdentityRole</span><span class="p">&gt;()</span>
</span><span class="hll">        <span class="p">.</span><span class="n">AddEntityFrameworkStores</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;()</span>
</span><span class="hll">        <span class="p">.</span><span class="n">AddDefaultTokenProviders</span><span class="p">();</span>
</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>

    <span class="c1">// Add application services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IEmailSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ISmsSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These services are then made available to the application through <a class="reference internal" href="../../fundamentals/dependency-injection.html"><span class="doc">dependency injection</span></a>.</p>
<p>Identity is enabled for the application by calling  <code class="docutils literal"><span class="pre">UseIdentity</span></code> in the <code class="docutils literal"><span class="pre">Configure</span></code> method of the <code class="docutils literal"><span class="pre">Startup</span></code> class. This adds cookie-based authentication to the request pipeline.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="c1">// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">,</span> <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">loggerFactory</span><span class="p">.</span><span class="n">AddConsole</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetSection</span><span class="p">(</span><span class="s">&quot;Logging&quot;</span><span class="p">));</span>
    <span class="n">loggerFactory</span><span class="p">.</span><span class="n">AddDebug</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">IsDevelopment</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseBrowserLink</span><span class="p">();</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseDeveloperExceptionPage</span><span class="p">();</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseDatabaseErrorPage</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseExceptionHandler</span><span class="p">(</span><span class="s">&quot;/Home/Error&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">app</span><span class="p">.</span><span class="n">UseIISPlatformHandler</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span> <span class="n">options</span><span class="p">.</span><span class="n">AuthenticationDescriptions</span><span class="p">.</span><span class="n">Clear</span><span class="p">());</span>

    <span class="n">app</span><span class="p">.</span><span class="n">UseStaticFiles</span><span class="p">();</span>

<span class="hll">    <span class="n">app</span><span class="p">.</span><span class="n">UseIdentity</span><span class="p">();</span>
</span>
    <span class="c1">// To configure external authentication please see http://go.microsoft.com/fwlink/?LinkID=532715</span>

    <span class="n">app</span><span class="p">.</span><span class="n">UseMvc</span><span class="p">(</span><span class="n">routes</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">routes</span><span class="p">.</span><span class="n">MapRoute</span><span class="p">(</span>
            <span class="n">name</span><span class="p">:</span> <span class="s">&quot;default&quot;</span><span class="p">,</span>
            <span class="n">template</span><span class="p">:</span> <span class="s">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about the application start up process, see <a class="reference internal" href="../../fundamentals/startup.html"><span class="doc">Application Startup</span></a>.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Creating a user.</li>
</ol>
<blockquote>
<div><p>Launch the application from Visual Studio (<strong>Debug</strong> -&gt; <strong>Start Debugging</strong>) and then click on the <strong>Register</strong> link in the browser to create a user. The following image shows the Register page which collects the user name and password.</p>
<img alt="../../_images/02-reg.png" src="../../_images/02-reg.png" />
<p>When the user clicks the <strong>Register</strong> link, the <code class="docutils literal"><span class="pre">UserManager</span></code> and <code class="docutils literal"><span class="pre">SignInManager</span></code> services are injected into the Controller:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">AccountController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">private</span> <span class="k">readonly</span> <span class="n">UserManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">_userManager</span><span class="p">;</span>
</span><span class="hll">        <span class="k">private</span> <span class="k">readonly</span> <span class="n">SignInManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">_signInManager</span><span class="p">;</span>
</span>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEmailSender</span> <span class="n">_emailSender</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ISmsSender</span> <span class="n">_smsSender</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ApplicationDbContext</span> <span class="n">_applicationDbContext</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">_databaseChecked</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span> <span class="n">_logger</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">AccountController</span><span class="p">(</span>
<span class="hll">            <span class="n">UserManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">userManager</span><span class="p">,</span>
</span><span class="hll">            <span class="n">SignInManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">signInManager</span><span class="p">,</span>
</span>            <span class="n">IEmailSender</span> <span class="n">emailSender</span><span class="p">,</span>
            <span class="n">ISmsSender</span> <span class="n">smsSender</span><span class="p">,</span>
            <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">,</span>
            <span class="n">ApplicationDbContext</span> <span class="n">applicationDbContext</span><span class="p">)</span>
        <span class="p">{</span>
<span class="hll">            <span class="n">_userManager</span> <span class="p">=</span> <span class="n">userManager</span><span class="p">;</span>
</span><span class="hll">            <span class="n">_signInManager</span> <span class="p">=</span> <span class="n">signInManager</span><span class="p">;</span>
</span>            <span class="n">_emailSender</span> <span class="p">=</span> <span class="n">emailSender</span><span class="p">;</span>
            <span class="n">_smsSender</span> <span class="p">=</span> <span class="n">smsSender</span><span class="p">;</span>
            <span class="n">_applicationDbContext</span> <span class="p">=</span> <span class="n">applicationDbContext</span><span class="p">;</span>
            <span class="n">_logger</span> <span class="p">=</span> <span class="n">loggerFactory</span><span class="p">.</span><span class="n">CreateLogger</span><span class="p">&lt;</span><span class="n">AccountController</span><span class="p">&gt;();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Then, the <strong>Register</strong> action creates the user by calling <code class="docutils literal"><span class="pre">CreateAsync</span></code> function of the <code class="docutils literal"><span class="pre">UserManager</span></code> object, as shown below:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="na">[HttpPost]</span>
<span class="na">[AllowAnonymous]</span>
<span class="na">[ValidateAntiForgeryToken]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Register</span><span class="p">(</span><span class="n">RegisterViewModel</span> <span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ApplicationUser</span> <span class="p">{</span> <span class="n">UserName</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">Email</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span> <span class="p">};</span>
<span class="hll">        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">CreateAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// For more information on how to enable account confirmation and password reset please visit http://go.microsoft.com/fwlink/?LinkID=532713</span>
            <span class="c1">// Send an email with this link</span>
            <span class="c1">//var code = await _userManager.GenerateEmailConfirmationTokenAsync(user);</span>
            <span class="c1">//var callbackUrl = Url.Action(&quot;ConfirmEmail&quot;, &quot;Account&quot;, new { userId = user.Id, code = code }, protocol: HttpContext.Request.Scheme);</span>
            <span class="c1">//await _emailSender.SendEmailAsync(model.Email, &quot;Confirm your account&quot;,</span>
            <span class="c1">//    &quot;Please confirm your account by clicking this link: &lt;a href=\&quot;&quot; + callbackUrl + &quot;\&quot;&gt;link&lt;/a&gt;&quot;);</span>
            <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">SignInAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">isPersistent</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">_logger</span><span class="p">.</span><span class="n">LogInformation</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">&quot;User created a new account with password.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">HomeController</span><span class="p">.</span><span class="n">Index</span><span class="p">),</span> <span class="s">&quot;Home&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">AddErrors</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// If we got this far, something failed, redisplay form</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Log in.</li>
</ol>
<blockquote>
<div><p>If the user was successfully created, the user is logged in by the <code class="docutils literal"><span class="pre">SignInAsync</span></code> method, also contained in the <code class="docutils literal"><span class="pre">Register</span></code> action. By signing in, the <code class="docutils literal"><span class="pre">SignInAsync</span></code> method stores a cookie with the user&#8217;s claims.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="na">[HttpPost]</span>
<span class="na">[AllowAnonymous]</span>
<span class="na">[ValidateAntiForgeryToken]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Register</span><span class="p">(</span><span class="n">RegisterViewModel</span> <span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ApplicationUser</span> <span class="p">{</span> <span class="n">UserName</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">Email</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span> <span class="p">};</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">CreateAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// For more information on how to enable account confirmation and password reset please visit http://go.microsoft.com/fwlink/?LinkID=532713</span>
            <span class="c1">// Send an email with this link</span>
            <span class="c1">//var code = await _userManager.GenerateEmailConfirmationTokenAsync(user);</span>
            <span class="c1">//var callbackUrl = Url.Action(&quot;ConfirmEmail&quot;, &quot;Account&quot;, new { userId = user.Id, code = code }, protocol: HttpContext.Request.Scheme);</span>
            <span class="c1">//await _emailSender.SendEmailAsync(model.Email, &quot;Confirm your account&quot;,</span>
            <span class="c1">//    &quot;Please confirm your account by clicking this link: &lt;a href=\&quot;&quot; + callbackUrl + &quot;\&quot;&gt;link&lt;/a&gt;&quot;);</span>
<span class="hll">            <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">SignInAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">isPersistent</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
</span>            <span class="n">_logger</span><span class="p">.</span><span class="n">LogInformation</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">&quot;User created a new account with password.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">HomeController</span><span class="p">.</span><span class="n">Index</span><span class="p">),</span> <span class="s">&quot;Home&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">AddErrors</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// If we got this far, something failed, redisplay form</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above <code class="docutils literal"><span class="pre">SignInAsync</span></code> method calls the below <code class="docutils literal"><span class="pre">SignInAsync</span></code> task, which is contained in the <code class="docutils literal"><span class="pre">SignInManager</span></code> class.</p>
<p>If needed, you can access the user&#8217;s identity details inside a controller action. For instance, by setting a breakpoint inside the <code class="docutils literal"><span class="pre">HomeController.Index</span></code> action method, you can view the <code class="docutils literal"><span class="pre">User.claims</span></code> details. By having the user signed-in, you can make authorization decisions. For more information, see <a class="reference internal" href="../authorization/index.html"><span class="doc">Authorization</span></a>.</p>
<p>As a registered user, you can log in to the web app by clicking the <strong>Log in</strong> link.  When a registered user logs in, the <code class="docutils literal"><span class="pre">Login</span></code> action of the <code class="docutils literal"><span class="pre">AccountController</span></code> is called. Then, the <strong>Login</strong> action signs in the user using the <code class="docutils literal"><span class="pre">PasswordSignInAsync</span></code> method contained in the <code class="docutils literal"><span class="pre">Login</span></code> action.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="na">[HttpPost]</span>
<span class="na">[AllowAnonymous]</span>
<span class="na">[ValidateAntiForgeryToken]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Login</span><span class="p">(</span><span class="n">LoginViewModel</span> <span class="n">model</span><span class="p">,</span> <span class="kt">string</span> <span class="n">returnUrl</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
    <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;ReturnUrl&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">returnUrl</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// This doesn&#39;t count login failures towards account lockout</span>
        <span class="c1">// To enable password failures to trigger account lockout, set lockoutOnFailure: true</span>
<span class="hll">        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">PasswordSignInAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">RememberMe</span><span class="p">,</span> <span class="n">lockoutOnFailure</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span><span class="p">.</span><span class="n">LogInformation</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;User logged in.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">RedirectToLocal</span><span class="p">(</span><span class="n">returnUrl</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">RequiresTwoFactor</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">SendCode</span><span class="p">),</span> <span class="k">new</span> <span class="p">{</span> <span class="n">ReturnUrl</span> <span class="p">=</span> <span class="n">returnUrl</span><span class="p">,</span> <span class="n">RememberMe</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">RememberMe</span> <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsLockedOut</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span><span class="p">.</span><span class="n">LogWarning</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="s">&quot;User account locked out.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="s">&quot;Lockout&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">ModelState</span><span class="p">.</span><span class="n">AddModelError</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="s">&quot;Invalid login attempt.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// If we got this far, something failed, redisplay form</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Log off.</li>
</ol>
<blockquote>
<div><p>Clicking the <strong>Log off</strong> link calls the <code class="docutils literal"><span class="pre">LogOff</span></code> action in the account controller.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">LogOff</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">SignOutAsync</span><span class="p">();</span>
</span>    <span class="n">_logger</span><span class="p">.</span><span class="n">LogInformation</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="s">&quot;User logged out.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">HomeController</span><span class="p">.</span><span class="n">Index</span><span class="p">),</span> <span class="s">&quot;Home&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The code above shows the <code class="docutils literal"><span class="pre">SignInManager.SignOutAsync</span></code> method. The <code class="docutils literal"><span class="pre">SignOutAsync</span></code> method clears the users claims stored in a cookie.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>View the database.</li>
</ol>
<blockquote>
<div><p>After stopping the application, view the user database from Visual Studio by selecting <strong>View</strong> -&gt; <strong>SQL Server Object Explorer</strong>. Then, expand the following within the <strong>SQL Server Object Explorer</strong>:</p>
<ul class="simple">
<li>(localdb)MSSQLLocalDB</li>
<li>Databases</li>
<li>aspnet5-&lt;<em>the name of your application</em>&gt;</li>
<li>Tables</li>
</ul>
<p>Next, right-click the <strong>dbo.AspNetUsers</strong> table and select <strong>View Data</strong> to see the properties of the user you created.</p>
<img alt="../../_images/04-db.png" src="../../_images/04-db.png" />
</div></blockquote>
</div>
<div class="section" id="identity-components">
<h2>Identity Components<a class="headerlink" href="#identity-components" title="Permalink to this headline">Â¶</a></h2>
<p>The primary reference assembly for the identity system is <code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Identity</span></code>. This package contains the core set of interfaces for ASP.NET Core Identity.</p>
<img alt="../../_images/05-dependencies.png" src="../../_images/05-dependencies.png" />
<p>These dependencies are needed to use the identity system in ASP.NET Core applications:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">EntityFramework.SqlServer</span></code> - Entity Framework is Microsoft&#8217;s recommended data access technology for relational databases.</li>
<li><code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Authentication.Cookies</span></code> - Middleware that enables an application to use cookie based authentication, similar to ASP.NET&#8217;s Forms Authentication.</li>
<li><code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Cryptography.KeyDerivation</span></code> - Utilities for key derivation.</li>
<li><code class="docutils literal"><span class="pre">Microsoft.AspNetCore.Hosting.Abstractions</span></code> - Hosting abstractions.</li>
</ul>
</div>
<div class="section" id="migrating-to-asp-net-core-identity">
<h2>Migrating to ASP.NET Core Identity<a class="headerlink" href="#migrating-to-asp-net-core-identity" title="Permalink to this headline">Â¶</a></h2>
<p>For additional information and guidance on migrating your existing identity store see <a class="reference internal" href="../../migration/identity.html"><span class="doc">Migrating Authentication and Identity</span></a></p>
</div>
<div class="section" id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../../migration/identity.html#migration-identity"><span class="std std-ref">Migrating Authentication and Identity</span></a></li>
<li><a class="reference internal" href="accconfirm.html#security-authentication-account-confirmation"><span class="std std-ref">Account Confirmation and Password Recovery</span></a></li>
<li><a class="reference internal" href="2fa.html#security-authentication-2fa"><span class="std std-ref">Two-factor authentication with SMS</span></a></li>
<li><a class="reference internal" href="sociallogins.html#security-authentication-social-logins"><span class="std std-ref">Enabling authentication using Facebook, Google and other external providers</span></a></li>
</ul>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sociallogins.html" class="btn btn-neutral float-right" title="Enabling authentication using Facebook, Google and other external providers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Authentication" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>