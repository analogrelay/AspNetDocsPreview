

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Two-factor authentication with SMS &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../../index.html"/>
        <link rel="up" title="Authentication" href="index.html"/>
        <link rel="next" title="ðŸ”§ Supporting Third Party Clients using OAuth 2.0" href="oauth2.html"/>
        <link rel="prev" title="Account Confirmation and Password Recovery" href="accconfirm.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Security</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Authentication</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="identity.html">Introduction to Identity</a></li>
<li class="toctree-l3"><a class="reference internal" href="sociallogins.html">Enabling authentication using Facebook, Google and other external providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="accconfirm.html">Account Confirmation and Password Recovery</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Two-factor authentication with SMS</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="oauth2.html">ðŸ”§ Supporting Third Party Clients using OAuth 2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="cookie.html">Using Cookie Middleware without ASP.NET Core Identity</a></li>
<li class="toctree-l3"><a class="reference internal" href="azure-active-directory/index.html">Azure Active Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../authorization/index.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-protection/index.html">Data Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-secrets.html">Safe storage of app secrets during development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enforcing-ssl.html">ðŸ”§ Enforcing SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../anti-request-forgery.html">ðŸ”§ Anti-Request Forgery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../open-redirect.html">ðŸ”§ Preventing Open Redirect Attacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross-site-scripting.html">ðŸ”§ Preventing Cross-Site Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cors.html">Enabling Cross-Origin Requests (CORS)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Security</a> &raquo;</li>
      
          <li><a href="index.html">Authentication</a> &raquo;</li>
      
    <li>Two-factor authentication with SMS</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/security/authentication/2fa.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="two-factor-authentication-with-sms">
<span id="security-authentication-2fa"></span><h1>Two-factor authentication with SMS<a class="headerlink" href="#two-factor-authentication-with-sms" title="Permalink to this headline">Â¶</a></h1>
<p>By <a class="reference external" href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<p>This tutorial will show you how to set up two-factor authentication (2FA) using SMS. Twilio is used, but you can use any other SMS provider. We recommend you complete <a class="reference internal" href="accconfirm.html"><span class="doc">Account Confirmation and Password Recovery</span></a> before starting this tutorial.</p>
<div class="contents local topic" id="sections">
<p class="topic-title first">Sections:</p>
<ul class="simple">
<li><a class="reference internal" href="#create-a-new-asp-net-core-project" id="id1">Create a new ASP.NET Core project</a></li>
<li><a class="reference internal" href="#setup-up-sms-for-two-factor-authentication-with-twilio" id="id2">Setup up SMS for two-factor authentication with Twilio</a></li>
<li><a class="reference internal" href="#enable-two-factor-authentication" id="id3">Enable two-factor authentication</a></li>
<li><a class="reference internal" href="#log-in-with-two-factor-authentication" id="id4">Log in with two-factor authentication</a></li>
<li><a class="reference internal" href="#account-lockout-for-protecting-against-brute-force-attacks" id="id5">Account lockout for protecting against brute force attacks</a></li>
<li><a class="reference internal" href="#debugging-twilio" id="id6">Debugging  Twilio</a></li>
</ul>
</div>
<div class="section" id="create-a-new-asp-net-core-project">
<h2><a class="toc-backref" href="#id1">Create a new ASP.NET Core project</a><a class="headerlink" href="#create-a-new-asp-net-core-project" title="Permalink to this headline">Â¶</a></h2>
<p>Create a new ASP.NET Core web app with individual user accounts.</p>
<img alt="../../_images/new-project1.png" src="../../_images/new-project1.png" />
<p>After you create the project, follow the instructions in <a class="reference internal" href="accconfirm.html"><span class="doc">Account Confirmation and Password Recovery</span></a> to set up and require SSL.</p>
</div>
<div class="section" id="setup-up-sms-for-two-factor-authentication-with-twilio">
<h2><a class="toc-backref" href="#id2">Setup up SMS for two-factor authentication with Twilio</a><a class="headerlink" href="#setup-up-sms-for-two-factor-authentication-with-twilio" title="Permalink to this headline">Â¶</a></h2>
<ul>
<li><p class="first">Create a <a class="reference external" href="http://www.twilio.com/">Twilio</a> account.</p>
</li>
<li><p class="first">On the <strong>Dashboard</strong> tab of your Twilio account, note the <strong>Account SID</strong> and <strong>Authentication token</strong>. Note: Tap <strong>Show API Credentials</strong> to see the Authentication token.</p>
</li>
<li><p class="first">On the <strong>Numbers</strong> tab, note the Twilio phone number.</p>
</li>
<li><p class="first">Install the Twilio NuGet package. From the Package Manager Console (PMC),  enter the following the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Install</span><span class="o">-</span><span class="n">Package</span> <span class="n">Twilio</span>
</pre></div>
</div>
</li>
<li><p class="first">Add code in the <em>Services/MessageServices.cs</em> file to enable SMS.</p>
</li>
</ul>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">AuthMessageSender</span> <span class="p">:</span> <span class="n">IEmailSender</span><span class="p">,</span> <span class="n">ISmsSender</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">AuthMessageSender</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">AuthMessageSMSSenderOptions</span><span class="p">&gt;</span> <span class="n">optionsAccessor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Options</span> <span class="p">=</span> <span class="n">optionsAccessor</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">AuthMessageSMSSenderOptions</span> <span class="n">Options</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">// set only via Secret Manager</span>

    <span class="k">public</span> <span class="n">Task</span> <span class="nf">SendEmailAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">email</span><span class="p">,</span> <span class="kt">string</span> <span class="n">subject</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Plug in your email service here to send an email.</span>
        <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="n">FromResult</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Task</span> <span class="nf">SendSmsAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">number</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">twilio</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Twilio</span><span class="p">.</span><span class="n">TwilioRestClient</span><span class="p">(</span>
            <span class="n">Options</span><span class="p">.</span><span class="n">SID</span><span class="p">,</span>           <span class="c1">// Account Sid from dashboard</span>
            <span class="n">Options</span><span class="p">.</span><span class="n">AuthToken</span><span class="p">);</span>    <span class="c1">// Auth Token</span>

        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">twilio</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">Options</span><span class="p">.</span><span class="n">SendNumber</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
        <span class="c1">// Use the debug output for testing without receiving a SMS message.</span>
        <span class="c1">// Remove the Debug.WriteLine(message) line after debugging.</span>
        <span class="c1">// System.Diagnostics.Debug.WriteLine(message);</span>
        <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="n">FromResult</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Twilio does not yet support <a class="reference external" href="https://microsoft.com/net/core">.NET Core</a>. To use Twilio from your application you need to either target the full .NET Framework or you can call the Twilio REST API to send SMS messages.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can remove <code class="docutils literal"><span class="pre">//</span></code> line comment characters from the <code class="docutils literal"><span class="pre">System.Diagnostics.Debug.WriteLine(message);</span></code> line to test the application when you can&#8217;t get SMS messages. A better approach to logging is to use the built in <a class="reference internal" href="../../fundamentals/logging.html#fundamentals-logging"><span class="std std-ref">logging</span></a>.</p>
</div>
<div class="section" id="configure-the-sms-provider-key-value">
<h3>Configure the SMS provider key/value<a class="headerlink" href="#configure-the-sms-provider-key-value" title="Permalink to this headline">Â¶</a></h3>
<p>We&#8217;ll use the <a class="reference internal" href="../../fundamentals/configuration.html#options-config-objects"><span class="std std-ref">Options pattern</span></a> to access the user account and key settings. For more information, see <a class="reference internal" href="../../fundamentals/configuration.html#fundamentals-configuration"><span class="std std-ref">configuration</span></a>.</p>
<blockquote>
<div><ul class="simple">
<li>Create a class to fetch the secure SMS key. For this sample, the <code class="docutils literal"><span class="pre">AuthMessageSMSSenderOptions</span></code> class is created in the <em>Services/AuthMessageSMSSenderOptions.cs</em> file.</li>
</ul>
</div></blockquote>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">AuthMessageSMSSenderOptions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">AuthToken</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SendNumber</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Set <code class="docutils literal"><span class="pre">SID</span></code>, <code class="docutils literal"><span class="pre">AuthToken</span></code>, and <code class="docutils literal"><span class="pre">SendNumber</span></code> with the <a class="reference internal" href="../app-secrets.html"><span class="doc">secret-manager tool</span></a>. For example:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>C:/WebSMS/src/WebApplication1&gt;user-secret set SID abcdefghi
info: Successfully saved SID = abcdefghi to the secret store.
</pre></div>
</div>
</div>
<div class="section" id="configure-startup-to-use-authmessagesmssenderoptions">
<h3>Configure startup to use <code class="docutils literal"><span class="pre">AuthMessageSMSSenderOptions</span></code><a class="headerlink" href="#configure-startup-to-use-authmessagesmssenderoptions" title="Permalink to this headline">Â¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">AuthMessageSMSSenderOptions</span></code> to the service container at the end of the <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method in the <em>Startup.cs</em> file:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span>    <span class="c1">// Register application services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IEmailSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ISmsSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">AuthMessageSMSSenderOptions</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="enable-two-factor-authentication">
<h2><a class="toc-backref" href="#id3">Enable two-factor authentication</a><a class="headerlink" href="#enable-two-factor-authentication" title="Permalink to this headline">Â¶</a></h2>
<ul>
<li><p class="first">Open the <em>Views/Manage/Index.cshtml</em> Razor view file.</p>
</li>
<li><p class="first">Uncomment the phone number markup which starts at</p>
<p><code class="docutils literal"><span class="pre">&#64;*&#64;(Model.PhoneNumber</span> <span class="pre">??</span> <span class="pre">&quot;None&quot;)</span></code></p>
</li>
<li><p class="first">Uncomment the <code class="docutils literal"><span class="pre">Model.TwoFactor</span></code> markup which starts at</p>
<p><code class="docutils literal"><span class="pre">&#64;*&#64;if</span> <span class="pre">(Model.TwoFactor)</span></code></p>
</li>
<li><p class="first">Comment out or remove the <code class="docutils literal"><span class="pre">&lt;p&gt;There</span> <span class="pre">are</span> <span class="pre">no</span> <span class="pre">two-factor</span> <span class="pre">authentication</span> <span class="pre">providers</span> <span class="pre">configured.</span></code> markup.</p>
</li>
</ul>
<blockquote>
<div><p>The completed code is shown below:</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Phone Number:<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Phone Numbers can used as a second factor of verification in two-factor authentication.
        See <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://go.microsoft.com/fwlink/?LinkID=532713&quot;</span><span class="p">&gt;</span>this article<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        for details on setting up this ASP.NET application to support two-factor authentication using SMS.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    @(Model.PhoneNumber ?? &quot;None&quot;) [
        @if (Model.PhoneNumber != null)
        {
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Manage&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;AddPhoneNumber&quot;</span><span class="p">&gt;</span>Change<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                @: <span class="ni">&amp;nbsp;</span>|<span class="ni">&amp;nbsp;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Manage&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;RemovePhoneNumber&quot;</span><span class="p">&gt;</span>Remove<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        }
        else
        {
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Manage&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;AddPhoneNumber&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        }
        ]
<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Two-Factor Authentication:<span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>
    @*<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        There are no two-factor authentication providers configured. See <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://go.microsoft.com/fwlink/?LinkID=532713&quot;</span><span class="p">&gt;</span>this article<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        for setting up this application to support two-factor authentication.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>*@
    @if (Model.TwoFactor)
        {
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Manage&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;DisableTwoFactorAuthentication&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-horizontal&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">text</span><span class="p">&gt;</span>
                    Enabled
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-link&quot;</span><span class="p">&gt;</span>Disable<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">text</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        }
        else
        {
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Manage&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;EnableTwoFactorAuthentication&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-horizontal&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">text</span><span class="p">&gt;</span>
                    Disabled
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-link&quot;</span><span class="p">&gt;</span>Enable<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">text</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        }
<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="log-in-with-two-factor-authentication">
<h2><a class="toc-backref" href="#id4">Log in with two-factor authentication</a><a class="headerlink" href="#log-in-with-two-factor-authentication" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li>Run the app and register a new user</li>
</ul>
<img alt="../../_images/login2fa1.png" src="../../_images/login2fa1.png" />
<ul class="simple">
<li>Tap on your user name, which activates the <code class="docutils literal"><span class="pre">Index</span></code> action method in Manage controller. Then tap the phone number <strong>Add</strong> link.</li>
</ul>
<img alt="../../_images/login2fa2.png" src="../../_images/login2fa2.png" />
<ul class="simple">
<li>Add a phone number that will receive the verification code, and tap <strong>Send verification code</strong>.</li>
</ul>
<img alt="../../_images/login2fa3.png" src="../../_images/login2fa3.png" />
<ul class="simple">
<li>You will get a text message with the verification code. Enter it and tap <strong>Submit</strong></li>
</ul>
<img alt="../../_images/login2fa4.png" src="../../_images/login2fa4.png" />
<p>If you don&#8217;t get a text message, see <a class="reference internal" href="#debugging-twilio">Debugging  Twilio</a>.</p>
<ul class="simple">
<li>The Manage view shows your phone number was added successfully.</li>
</ul>
<img alt="../../_images/login2fa5.png" src="../../_images/login2fa5.png" />
<ul class="simple">
<li>Tap <strong>Enable</strong> to enable two-factor authentication.</li>
</ul>
<img alt="../../_images/login2fa6.png" src="../../_images/login2fa6.png" />
<div class="section" id="test-two-factor-authentication">
<h3>Test two-factor authentication<a class="headerlink" href="#test-two-factor-authentication" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li>Log off.</li>
<li>Log in.</li>
<li>The user account has enabled two-factor authentication, so you have to provide the second factor of authentication . In this tutorial you have enabled phone verification. The built in templates also allow you to set up email as the second factor. You can set up additional second factors for authentication such as QR codes. Tap <strong>Submit</strong>.</li>
</ul>
<img alt="../../_images/login2fa7.png" src="../../_images/login2fa7.png" />
<ul class="simple">
<li>Enter the code you get in the SMS message.</li>
<li>Clicking on the <strong>Remember this browser</strong> check box will exempt you from needing to use 2FA to log on when using the same device and browser. Enabling 2FA and clicking on <strong>Remember this browser</strong> will provide you with strong 2FA protection from malicious users trying to access your account, as long as they don&#8217;t have access to your device. You can do this on any private device you regularly use. By setting  <strong>Remember this browser</strong>, you get the added security of 2FA from devices you don&#8217;t regularly use, and you get the convenience on not having to go through 2FA on your own devices.</li>
</ul>
<img alt="../../_images/login2fa8.png" src="../../_images/login2fa8.png" />
</div>
</div>
<div class="section" id="account-lockout-for-protecting-against-brute-force-attacks">
<h2><a class="toc-backref" href="#id5">Account lockout for protecting against brute force attacks</a><a class="headerlink" href="#account-lockout-for-protecting-against-brute-force-attacks" title="Permalink to this headline">Â¶</a></h2>
<p>We recommend you use account lockout with 2FA. Once a user logs in (through a local account or social account), each failed attempt at 2FA is stored, and if the maximum attempts (default is 5) is reached, the user is locked out for five minutes (you can set the lock out time with <code class="docutils literal"><span class="pre">DefaultAccountLockoutTimeSpan</span></code>).
The following configures Account to be locked out for 10 minutes after 10 failed attempts.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">IdentityOptions</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">options</span><span class="p">.</span><span class="n">Lockout</span><span class="p">.</span><span class="n">DefaultLockoutTimeSpan</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMinutes</span><span class="p">(</span><span class="m">10</span><span class="p">);</span>
</span><span class="hll">        <span class="n">options</span><span class="p">.</span><span class="n">Lockout</span><span class="p">.</span><span class="n">MaxFailedAccessAttempts</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span><span class="hll">    <span class="p">});</span>
</span>
    <span class="c1">// Register application services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IEmailSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ISmsSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">AuthMessageSMSSenderOptions</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging-twilio">
<h2><a class="toc-backref" href="#id6">Debugging  Twilio</a><a class="headerlink" href="#debugging-twilio" title="Permalink to this headline">Â¶</a></h2>
<p>If you&#8217;re able to use the Twilio API, but you don&#8217;t get an SMS message, try the following:</p>
<ol class="arabic simple">
<li>Log in to the Twilio site and navigate to the <strong>Logs</strong> &gt; <strong>SMS &amp; MMS Logs</strong> page. You can verify that messages were sent and delivered.</li>
<li>Use the following code in a console application to test Twilio:</li>
</ol>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">string</span> <span class="n">AccountSid</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="kt">string</span> <span class="n">AuthToken</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">twilio</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Twilio</span><span class="p">.</span><span class="n">TwilioRestClient</span><span class="p">(</span><span class="n">AccountSid</span><span class="p">,</span> <span class="n">AuthToken</span><span class="p">);</span>
  <span class="kt">string</span> <span class="n">FromPhone</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="kt">string</span> <span class="n">toPhone</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">twilio</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">FromPhone</span><span class="p">,</span> <span class="n">toPhone</span><span class="p">,</span> <span class="s">&quot;Twilio Test&quot;</span><span class="p">);</span>
  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">Sid</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="oauth2.html" class="btn btn-neutral float-right" title="ðŸ”§ Supporting Third Party Clients using OAuth 2.0" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="accconfirm.html" class="btn btn-neutral" title="Account Confirmation and Password Recovery" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>