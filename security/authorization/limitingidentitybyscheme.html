

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Limiting identity by scheme &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../../index.html"/>
        <link rel="up" title="Authorization" href="index.html"/>
        <link rel="next" title="ðŸ”§ Authorization Filters" href="authorization-filters.html"/>
        <link rel="prev" title="View Based Authorization" href="views.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../authentication/index.html">Authentication</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Authorization</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="simple.html">Simple Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="roles.html">Role based Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="claims.html">Claims-Based Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="policies.html">Custom Policy-Based Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="dependencyinjection.html">Dependency Injection in Requirement Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="resourcebased.html">Resource Based Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="views.html">View Based Authorization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Limiting identity by scheme</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="authorization-filters.html">ðŸ”§ Authorization Filters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data-protection/index.html">Data Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-secrets.html">Safe storage of app secrets during development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enforcing-ssl.html">ðŸ”§ Enforcing SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../anti-request-forgery.html">ðŸ”§ Anti-Request Forgery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../open-redirect.html">ðŸ”§ Preventing Open Redirect Attacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross-site-scripting.html">ðŸ”§ Preventing Cross-Site Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cors.html">Enabling Cross-Origin Requests (CORS)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Security</a> &raquo;</li>
      
          <li><a href="index.html">Authorization</a> &raquo;</li>
      
    <li>Limiting identity by scheme</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/security/authorization/limitingidentitybyscheme.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="limiting-identity-by-scheme">
<span id="security-authorization-limiting-by-scheme"></span><h1>Limiting identity by scheme<a class="headerlink" href="#limiting-identity-by-scheme" title="Permalink to this headline">Â¶</a></h1>
<p>In some scenarios, such as Single Page Applications it is possible to end up with multiple authentication methods, cookie authentication to log in and bearer authentication for javascript request. In some cases you may have multiple instances of an authentication middleware, for example, two cookie middlewares where one contains a basic identity and one is created when a multi-factor authentication has triggered because the user requested an operation that requires extra security.</p>
<p>Authentication schemes are named when authentication middleware is configured during authentication, for example</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">app</span><span class="p">.</span><span class="n">UseCookieAuthentication</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">AuthenticationScheme</span> <span class="p">=</span> <span class="s">&quot;Cookie&quot;</span><span class="p">;</span>
    <span class="n">options</span><span class="p">.</span><span class="n">LoginPath</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PathString</span><span class="p">(</span><span class="s">&quot;/Account/Unauthorized/&quot;</span><span class="p">);</span>
    <span class="n">options</span><span class="p">.</span><span class="n">AccessDeniedPath</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PathString</span><span class="p">(</span><span class="s">&quot;/Account/Forbidden/&quot;</span><span class="p">);</span>
    <span class="n">options</span><span class="p">.</span><span class="n">AutomaticAuthenticate</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">});</span>

<span class="n">app</span><span class="p">.</span><span class="n">UseBearerAuthentication</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">AuthenticationScheme</span> <span class="p">=</span> <span class="s">&quot;Bearer&quot;</span><span class="p">;</span>
    <span class="n">options</span><span class="p">.</span><span class="n">AutomaticAuthenticate</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>In this configuration two authentication middlewares have been added, one for cookies and one for bearer.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When adding multiple authentication middleware you should ensure that no middleware is configured to run automatically. You do this by setting the <code class="docutils literal"><span class="pre">AutomaticAuthentication</span></code> options property to false. If you fail to do this filtering by scheme will not work.</p>
</div>
</div></blockquote>
<div class="section" id="selecting-the-scheme-with-the-authorize-attribute">
<h2>Selecting the scheme with the Authorize attribute<a class="headerlink" href="#selecting-the-scheme-with-the-authorize-attribute" title="Permalink to this headline">Â¶</a></h2>
<p>As no authentication middleware is configured to automatically run and create an identity you must, at the point of authorization choose which middleware will be used. The simplest way to select the middleware you wish to authorize wish is to use the <code class="docutils literal"><span class="pre">AuthenticationSchemes</span></code> parameter. This parameter accepts a comma delimited list of Authentication Schemes to use. For example;</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="na">[Authorize(AuthenticationSchemes = &quot;Cookie,Bearer&quot;)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">MixedController</span> <span class="p">:</span> <span class="n">Controller</span>
</pre></div>
</div>
<p>In the example above both the cookie and bearer middlewares will run and have a chance to create and append an identity for the current user. By specifying a single scheme only the specified middleware will run;</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="na">[Authorize(AuthenticationSchemes = &quot;Bearer&quot;)]</span>
</pre></div>
</div>
<p>In this case only the middleware with the Bearer scheme would run, and any cookie based identities would be ignored.</p>
</div>
<div class="section" id="selecting-the-scheme-with-policies">
<h2>Selecting the scheme with policies<a class="headerlink" href="#selecting-the-scheme-with-policies" title="Permalink to this headline">Â¶</a></h2>
<p>If you prefer to specify the desired schemes in <a class="reference internal" href="policies.html#security-authorization-policies-based"><span class="std std-ref">policy</span></a> you can set the <code class="docutils literal"><span class="pre">AuthenticationSchemes</span></code> collection when adding your policy.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">options</span><span class="p">.</span><span class="n">AddPolicy</span><span class="p">(</span><span class="s">&quot;Over18&quot;</span><span class="p">,</span> <span class="n">policy</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">policy</span><span class="p">.</span><span class="n">AuthenticationSchemes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;Bearer&quot;</span><span class="p">);</span>
    <span class="n">policy</span><span class="p">.</span><span class="n">RequireAuthenticatedUser</span><span class="p">();</span>
    <span class="n">policy</span><span class="p">.</span><span class="n">Requirements</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Over18Requirement</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>
</div>
<p>In this example the Over18 policy will only run against the identity created by the Bearer middleware.</p>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="authorization-filters.html" class="btn btn-neutral float-right" title="ðŸ”§ Authorization Filters" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="views.html" class="btn btn-neutral" title="View Based Authorization" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>