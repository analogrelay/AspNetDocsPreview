

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding Search &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../../index.html"/>
        <link rel="up" title="Building your first ASP.NET Core MVC app with Visual Studio" href="index.html"/>
        <link rel="next" title="Adding a New Field" href="new-field.html"/>
        <link rel="prev" title="Controller methods and views" href="controller-methods-views.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../your-first-mac-aspnet.html">Your First ASP.NET Core Application on a Mac Using Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-web-api.html">Building Your First Web API with ASP.NET Core MVC and Visual Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publish-to-azure-webapp-using-vs.html">Deploy an ASP.NET Core web app to Azure using Visual Studio</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Building your first ASP.NET Core MVC app with Visual Studio</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="start-mvc.html">Getting started with ASP.NET Core MVC and Visual Studio</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding-controller.html">Adding a controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding-view.html">Adding a view</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding-model.html">Adding a model</a></li>
<li class="toctree-l3"><a class="reference internal" href="working-with-sql.html">Working with SQL Server LocalDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="controller-methods-views.html">Controller methods and views</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Adding Search</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="new-field.html">Adding a New Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Adding Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="details.html">Examining the Details and Delete methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nano-server.html">ASP.NET Core on Nano Server</a></li>
<li class="toctree-l2"><a class="reference external" href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-add-a-web-frontend/">ASP.NET Core and Azure Service Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mobile/native-mobile-backend.html">ðŸ”§ Creating Backend Services for Native Mobile Applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Tutorials</a> &raquo;</li>
      
          <li><a href="index.html">Building your first ASP.NET Core MVC app with Visual Studio</a> &raquo;</li>
      
    <li>Adding Search</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/tutorials/first-mvc-app/search.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="adding-search">
<h1>Adding Search<a class="headerlink" href="#adding-search" title="Permalink to this headline">Â¶</a></h1>
<p>By <a class="reference external" href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<p>In this section you&#8217;ll add search capability to the <code class="docutils literal"><span class="pre">Index</span></code> action method that lets you search movies by <em>genre</em> or <em>name</em>.</p>
<p>Update the <code class="docutils literal"><span class="pre">Index</span></code> action method to enable search:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">searchString</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">movies</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                 <span class="k">select</span> <span class="n">m</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">searchString</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">searchString</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="k">await</span> <span class="n">movies</span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first line of the <code class="docutils literal"><span class="pre">Index</span></code> action method creates a <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb397926.aspx">LINQ</a> query to select the movies:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">movies</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
             <span class="k">select</span> <span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>The query is <em>only</em> defined at this point, it <strong>has not</strong> been run against the database.</p>
<p>If the <code class="docutils literal"><span class="pre">searchString</span></code> parameter contains a string, the movies query is modified to filter on the value of the search string, using the following code:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">searchString</span><span class="p">))</span>
<span class="p">{</span>
<span class="hll">    <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">searchString</span><span class="p">));</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">s</span> <span class="pre">=&gt;</span> <span class="pre">s.Title.Contains()</span></code> code above is a <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb397687.aspx">Lambda Expression</a>. Lambdas are used in method-based <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb397926.aspx">LINQ</a> queries as arguments to standard query operator methods such as the <a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.linq.enumerable.where.aspx">Where</a> method or <code class="docutils literal"><span class="pre">Contains</span></code> used in the code above. LINQ queries are not executed when they are defined or when they are modified by calling a method such as <code class="docutils literal"><span class="pre">Where</span></code>, <code class="docutils literal"><span class="pre">Contains</span></code>  or <code class="docutils literal"><span class="pre">OrderBy</span></code>. Instead, query execution is deferred, which means that the evaluation of an expression is delayed until its realized value is actually iterated over or the <code class="docutils literal"><span class="pre">ToListAsync</span></code> method is called. For more information about deferred query execution, see <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb738633.aspx">Query Execution</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb155125.aspx">Contains</a> method is run on the database, not the c# code above. On the database, <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb155125.aspx">Contains</a> maps to <a class="reference external" href="http://msdn.microsoft.com/en-us/library/ms179859.aspx">SQL LIKE</a>, which is case insensitive.</p>
</div>
<p>Navigate to <code class="docutils literal"><span class="pre">/Movies/Index</span></code>. Append a query string such as <code class="docutils literal"><span class="pre">?searchString=ghost</span></code> to the URL. The filtered movies are displayed.</p>
<img alt="../../_images/ghost.png" src="../../_images/ghost.png" />
<p>If you change the signature of the <code class="docutils literal"><span class="pre">Index</span></code> method to have a parameter named <code class="docutils literal"><span class="pre">id</span></code>, the <code class="docutils literal"><span class="pre">id</span></code> parameter will match the optional <code class="docutils literal"><span class="pre">{id}</span></code> placeholder for the default routes set in <em>Startup.cs</em>.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">app</span><span class="p">.</span><span class="n">UseMvc</span><span class="p">(</span><span class="n">routes</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">routes</span><span class="p">.</span><span class="n">MapRoute</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="hll">        <span class="n">template</span><span class="p">:</span> <span class="s">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span><span class="p">);</span>
</span><span class="p">});</span>
</pre></div>
</div>
<p>You can quickly rename the <code class="docutils literal"><span class="pre">searchString</span></code> parameter to <code class="docutils literal"><span class="pre">id</span></code> with the <strong>rename</strong> command. Right click on <code class="docutils literal"><span class="pre">searchString</span></code> <strong>&gt; Rename</strong>.</p>
<img alt="../../_images/rename.png" src="../../_images/rename.png" />
<p>The rename targets are highlighted.</p>
<img alt="../../_images/rename2.png" src="../../_images/rename2.png" />
<p>Change the parameter to <code class="docutils literal"><span class="pre">id</span></code> and all occurrences of <code class="docutils literal"><span class="pre">searchString</span></code> change to <code class="docutils literal"><span class="pre">id</span></code>.</p>
<img alt="../../_images/rename3.png" src="../../_images/rename3.png" />
<p>The previous <code class="docutils literal"><span class="pre">Index</span></code> method:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="hll"><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">searchString</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="kt">var</span> <span class="n">movies</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                 <span class="k">select</span> <span class="n">m</span><span class="p">;</span>

<span class="hll">    <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">searchString</span><span class="p">))</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">searchString</span><span class="p">));</span>
</span>    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="k">await</span> <span class="n">movies</span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The updated <code class="docutils literal"><span class="pre">Index</span></code> method:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="hll"><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">id</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="kt">var</span> <span class="n">movies</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                 <span class="k">select</span> <span class="n">m</span><span class="p">;</span>

<span class="hll">    <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
</span>    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="k">await</span> <span class="n">movies</span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can now pass the search title as route data (a URL segment) instead of as a query string value.</p>
<img alt="../../_images/g2.png" src="../../_images/g2.png" />
<p>However, you can&#8217;t expect users to modify the URL every time they want to search for a movie. So now you&#8217;ll add UI to help them filter movies. If you changed the signature of the <code class="docutils literal"><span class="pre">Index</span></code> method to test how to pass the route-bound <code class="docutils literal"><span class="pre">ID</span></code> parameter, change it back so that it takes a parameter named <code class="docutils literal"><span class="pre">searchString</span></code>:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="hll"><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">searchString</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="kt">var</span> <span class="n">movies</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                 <span class="k">select</span> <span class="n">m</span><span class="p">;</span>

<span class="hll">    <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">searchString</span><span class="p">))</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">searchString</span><span class="p">));</span>
</span>    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="k">await</span> <span class="n">movies</span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-HTML"><div class="highlight"><pre><span></span>@model IEnumerable<span class="p">&lt;</span><span class="nt">MvcMovie.Models.Movie</span><span class="p">&gt;</span>

@{
    ViewData[&quot;Title&quot;] = &quot;Index&quot;;
}

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Index<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Create&quot;</span><span class="p">&gt;</span>Create New<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="hll"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Movies&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Index&quot;</span><span class="p">&gt;</span>
</span><span class="hll">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">        Title: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;SearchString&quot;</span><span class="p">&gt;</span>
</span><span class="hll">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Filter&quot;</span> <span class="p">/&gt;</span>
</span><span class="hll">    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span>
<span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The HTML <code class="docutils literal"><span class="pre">&lt;form&gt;</span></code> tag uses the <a class="reference internal" href="../../mvc/views/working-with-forms.html"><span class="doc">Form Tag Helper</span></a>, so when you submit the form, the filter string is posted to the <code class="docutils literal"><span class="pre">Index</span></code> action of the movies controller. Save your changes and then test the filter.</p>
<img alt="../../_images/filter.png" src="../../_images/filter.png" />
<p>There&#8217;s no <code class="docutils literal"><span class="pre">[HttpPost]</span></code> overload of the <code class="docutils literal"><span class="pre">Index</span></code> method as you might expect. You don&#8217;t need it, because the method isn&#8217;t changing the state of the app, just filtering data.</p>
<p>You could add the following <code class="docutils literal"><span class="pre">[HttpPost]</span> <span class="pre">Index</span></code> method.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="hll"><span class="na">[HttpPost]</span>
</span><span class="k">public</span> <span class="kt">string</span> <span class="nf">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">searchString</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">notUsed</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;From [HttpPost]Index: filter on &quot;</span> <span class="p">+</span> <span class="n">searchString</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">notUsed</span></code> parameter is used to create an overload for the <code class="docutils literal"><span class="pre">Index</span></code> method. We&#8217;ll talk about that later in the tutorial.</p>
<p>If you add this method, the action invoker would match the <code class="docutils literal"><span class="pre">[HttpPost]</span> <span class="pre">Index</span></code> method, and the <code class="docutils literal"><span class="pre">[HttpPost]</span> <span class="pre">Index</span></code> method would run as shown in the image below.</p>
<img alt="../../_images/fo.png" src="../../_images/fo.png" />
<p>However, even if you add this <code class="docutils literal"><span class="pre">[HttpPost]</span></code> version of the <code class="docutils literal"><span class="pre">Index</span></code> method, there&#8217;s a limitation in how this has all been implemented. Imagine that you want to bookmark a particular search or you want to send a link to friends that they can click in order to see the same filtered list of movies. Notice that the URL for the HTTP POST request is the same as the URL for the GET request (localhost:xxxxx/Movies/Index) &#8211; there&#8217;s no search information in the URL. The search string information is sent to the server as a <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms/Sending_and_retrieving_form_data">form field value</a>. You can verify that with the <a class="reference external" href="https://dev.windows.com/en-us/microsoft-edge/platform/documentation/f12-devtools-guide/">F12 Developer tools</a> or the excellent <a class="reference external" href="http://www.telerik.com/fiddler">Fiddler tool</a>. Start the <a class="reference external" href="https://dev.windows.com/en-us/microsoft-edge/platform/documentation/f12-devtools-guide/">F12 tool</a>:</p>
<p>Tap the <strong>http://localhost:xxx/Movies  HTTP POST 200</strong> line and then tap <strong>Body  &gt; Request Body</strong>.</p>
<img alt="../../_images/f12_rb.png" src="../../_images/f12_rb.png" />
<p>You can see the search parameter and <a class="reference internal" href="../../security/anti-request-forgery.html"><span class="doc">XSRF</span></a> token in the request body. Note, as mentioned in the previous tutorial, the <a class="reference internal" href="../../mvc/views/working-with-forms.html"><span class="doc">Form Tag Helper</span></a> generates an <a class="reference internal" href="../../security/anti-request-forgery.html"><span class="doc">XSRF</span></a> anti-forgery token. We&#8217;re not modifying data, so we don&#8217;t need to validate the token in the controller method.</p>
<p>Because the search parameter is in the request body and not the URL, you can&#8217;t capture that search information to bookmark or share with others. We&#8217;ll fix this by specifying the request should be <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">GET</span></code>. Notice how intelliSense helps us update the markup.</p>
<img alt="../../_images/int_m.png" src="../../_images/int_m.png" />
<img alt="../../_images/int_get.png" src="../../_images/int_get.png" />
<p>Notice the distinctive font in the <code class="docutils literal"><span class="pre">&lt;form&gt;</span></code> tag. That distinctive font indicates the tag is supported by <a class="reference internal" href="../../mvc/views/tag-helpers/intro.html"><span class="doc">Tag Helpers</span></a>.</p>
<img alt="../../_images/th_font.png" src="../../_images/th_font.png" />
<p>Now when you submit a search, the URL contains the search query string. Searching will also go to the <code class="docutils literal"><span class="pre">HttpGet</span> <span class="pre">Index</span></code> action method, even if you have a <code class="docutils literal"><span class="pre">HttpPost</span> <span class="pre">Index</span></code> method.</p>
<img alt="../../_images/search_get.png" src="../../_images/search_get.png" />
<div class="section" id="adding-search-by-genre">
<h2>Adding Search by Genre<a class="headerlink" href="#adding-search-by-genre" title="Permalink to this headline">Â¶</a></h2>
<p>Add the following <code class="docutils literal"><span class="pre">MovieGenreViewModel</span></code> class to the <em>Models</em> folder:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc.Rendering</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MvcMovie.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MovieGenreViewModel</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Movie</span><span class="p">&gt;</span> <span class="n">movies</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">SelectList</span> <span class="n">genres</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">movieGenre</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The move-genre view model will contain:</p>
<blockquote>
<div><ul class="simple">
<li>a list of movies</li>
<li>a <a class="reference external" href="https://docs.asp.net/projects/api/en/latest/autoapi/Microsoft/AspNetCore/Mvc/Rendering/SelectList/index.html">SelectList</a> containing the list of genres. This will allow the user to select a genre from the list.</li>
<li><code class="docutils literal"><span class="pre">movieGenre</span></code>, which contains the selected genre</li>
</ul>
</div></blockquote>
<p>Replace the <code class="docutils literal"><span class="pre">Index</span></code> method with the following code:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">movieGenre</span><span class="p">,</span> <span class="kt">string</span> <span class="n">searchString</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IQueryable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">genreQuery</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                                    <span class="k">orderby</span> <span class="n">m</span><span class="p">.</span><span class="n">Genre</span>
                                    <span class="k">select</span> <span class="n">m</span><span class="p">.</span><span class="n">Genre</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">movies</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                 <span class="k">select</span> <span class="n">m</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">searchString</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">searchString</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">movieGenre</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">movies</span> <span class="p">=</span> <span class="n">movies</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Genre</span> <span class="p">==</span> <span class="n">movieGenre</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">movieGenreVM</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MovieGenreViewModel</span><span class="p">();</span>
    <span class="n">movieGenreVM</span><span class="p">.</span><span class="n">genres</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SelectList</span><span class="p">(</span><span class="k">await</span> <span class="n">genreQuery</span><span class="p">.</span><span class="n">Distinct</span><span class="p">().</span><span class="n">ToListAsync</span><span class="p">());</span>
    <span class="n">movieGenreVM</span><span class="p">.</span><span class="n">movies</span> <span class="p">=</span> <span class="k">await</span> <span class="n">movies</span><span class="p">.</span><span class="n">ToListAsync</span><span class="p">();</span>

    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">movieGenreVM</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following code is a <code class="docutils literal"><span class="pre">LINQ</span></code> query that retrieves all the genres from the database.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">genreQuery</span> <span class="p">=</span> <span class="k">from</span> <span class="n">m</span> <span class="k">in</span> <span class="n">_context</span><span class="p">.</span><span class="n">Movie</span>
                                <span class="k">orderby</span> <span class="n">m</span><span class="p">.</span><span class="n">Genre</span>
                                <span class="k">select</span> <span class="n">m</span><span class="p">.</span><span class="n">Genre</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">SelectList</span></code> of genres is created by projecting the distinct genres (we don&#8217;t want our select list to have duplicate genres).</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">movieGenreVM</span><span class="p">.</span><span class="n">genres</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SelectList</span><span class="p">(</span><span class="k">await</span> <span class="n">genreQuery</span><span class="p">.</span><span class="n">Distinct</span><span class="p">().</span><span class="n">ToListAsync</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-search-by-genre-to-the-index-view">
<h2>Adding search by genre to the Index view<a class="headerlink" href="#adding-search-by-genre-to-the-index-view" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-HTML"><div class="highlight"><pre><span></span><span class="hll">@model MovieGenreViewModel
</span>
@{
    ViewData[&quot;Title&quot;] = &quot;Index&quot;;
}

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Index<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Create&quot;</span><span class="p">&gt;</span>Create New<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">asp-controller</span><span class="o">=</span><span class="s">&quot;Movies&quot;</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Index&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;get&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="hll">        <span class="p">&lt;</span><span class="nt">select</span> <span class="na">asp-for</span><span class="o">=</span><span class="s">&quot;movieGenre&quot;</span> <span class="na">asp-items</span><span class="o">=</span><span class="s">&quot;Model.genres&quot;</span><span class="p">&gt;</span>
</span><span class="hll">            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>All<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
</span><span class="hll">        <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</span>
        Title: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;SearchString&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Filter&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>
<span class="hll">            @Html.DisplayNameFor(model =&gt; model.movies[0].Genre)
</span>        <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>
            @Html.DisplayNameFor(model =&gt; model.movies[0].Price)
        <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>
            @Html.DisplayNameFor(model =&gt; model.movies[0].ReleaseDate)
        <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>
            @Html.DisplayNameFor(model =&gt; model.movies[0].Title)
        <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
<span class="hll">        @foreach (var item in Model.movies)
</span>        {
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    @Html.DisplayFor(modelItem =&gt; item.Genre)
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    @Html.DisplayFor(modelItem =&gt; item.Price)
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    @Html.DisplayFor(modelItem =&gt; item.ReleaseDate)
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    @Html.DisplayFor(modelItem =&gt; item.Title)
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Edit&quot;</span> <span class="na">asp-route-id</span><span class="o">=</span><span class="s">&quot;@item.ID&quot;</span><span class="p">&gt;</span>Edit<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Details&quot;</span> <span class="na">asp-route-id</span><span class="o">=</span><span class="s">&quot;@item.ID&quot;</span><span class="p">&gt;</span>Details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">asp-action</span><span class="o">=</span><span class="s">&quot;Delete&quot;</span> <span class="na">asp-route-id</span><span class="o">=</span><span class="s">&quot;@item.ID&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        }
    <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Test the app by searching by genre, by movie title, and by both.</p>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="new-field.html" class="btn btn-neutral float-right" title="Adding a New Field" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="controller-methods-views.html" class="btn btn-neutral" title="Controller methods and views" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>