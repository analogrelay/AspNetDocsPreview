

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ASP.NET Core on Nano Server &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="ðŸ”§ Creating Backend Services for Native Mobile Applications" href="../mobile/native-mobile-backend.html"/>
        <link rel="prev" title="Examining the Details and Delete methods" href="first-mvc-app/details.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="your-first-mac-aspnet.html">Your First ASP.NET Core Application on a Mac Using Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="first-web-api.html">Building Your First Web API with ASP.NET Core MVC and Visual Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="publish-to-azure-webapp-using-vs.html">Deploy an ASP.NET Core web app to Azure using Visual Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="first-mvc-app/index.html">Building your first ASP.NET Core MVC app with Visual Studio</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ASP.NET Core on Nano Server</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-add-a-web-frontend/">ASP.NET Core and Azure Service Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mobile/native-mobile-backend.html">ðŸ”§ Creating Backend Services for Native Mobile Applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      
    <li>ASP.NET Core on Nano Server</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/nano-server.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="asp-net-core-on-nano-server">
<span id="nano-server"></span><h1>ASP.NET Core on Nano Server<a class="headerlink" href="#asp-net-core-on-nano-server" title="Permalink to this headline">Â¶</a></h1>
<p>By <a class="reference external" href="https://twitter.com/sshirhatti">Sourabh Shirhatti</a></p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">This tutorial uses a pre-release version of the Nano Server installation option of Windows Server Technical Preview 5. You may use the software in the virtual hard disk image only to internally demonstrate and evaluate it. You may not use the software in a live operating environment. Please see <a class="reference external" href="https://go.microsoft.com/fwlink/?LinkId=624232">https://go.microsoft.com/fwlink/?LinkId=624232</a> for specific information about the end date for the preview.</p>
</div>
<p>In this tutorial, you&#8217;ll take an existing ASP.NET Core app and deploy it to a Nano Server instance running IIS.</p>
<div class="contents local topic" id="sections">
<p class="topic-title first">Sections:</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#setting-up-the-nano-server-instance" id="id4">Setting up the Nano Server Instance</a></li>
<li><a class="reference internal" href="#installing-the-asp-net-core-module" id="id5">Installing the ASP.NET Core Module</a></li>
<li><a class="reference internal" href="#installing-iis" id="id6">Installing IIS</a></li>
<li><a class="reference internal" href="#id1" id="id7">Installing the ASP.NET Core Module</a></li>
<li><a class="reference internal" href="#enabling-the-asp-net-core-module" id="id8">Enabling the ASP.NET Core Module</a></li>
<li><a class="reference internal" href="#installing-net-core-framework" id="id9">Installing .NET Core Framework</a></li>
<li><a class="reference internal" href="#publishing-the-application" id="id10">Publishing the application</a></li>
<li><a class="reference internal" href="#open-a-port-in-the-firewall" id="id11">Open a Port in the Firewall</a></li>
<li><a class="reference internal" href="#running-the-application" id="id12">Running the Application</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h2>
<p>Nano Server is an installation option in Windows Server 2016, offering a tiny footprint, better security and better servicing than Server Core or full Server. Please consult the official <a class="reference external" href="https://technet.microsoft.com/en-us/library/mt126167.aspx">Nano Server documentation</a> for more details.  There are 3 ways for you try out Nano Server for yourself:</p>
<ol class="arabic simple">
<li>You can download the Windows Server 2016 Technical Preview 5 ISO file, and build a Nano Server image</li>
<li>Download the Nano Server developer VHD</li>
<li>Create a VM in Azure using the Nano Server image in the Azure Gallery. If you donâ€™t have an Azure account, you can get a free 30-day trial</li>
</ol>
<p>In this tutorial, we will be using the pre-built <a class="reference external" href="https://msdn.microsoft.com/en-us/virtualization/windowscontainers/nano_eula">Nano Server Developer VHD</a>  from Windows Server Technical Preview 5.</p>
<p>Before proceeding with this tutorial, you will need the <a class="reference internal" href="../publishing/index.html"><span class="doc">published</span></a> output of an existing ASP.NET Core application. Ensure your application is built to run in a <strong>64-bit</strong> process.</p>
</div>
<div class="section" id="setting-up-the-nano-server-instance">
<h2><a class="toc-backref" href="#id4">Setting up the Nano Server Instance</a><a class="headerlink" href="#setting-up-the-nano-server-instance" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://technet.microsoft.com/en-us/library/hh846766.aspx">Create a new Virtual Machine using Hyper-V</a> on your development machine using the previously downloaded VHD. The machine will require you to set an administator password before logging on. At the VM console, press F11 to set the password before the first logon.</p>
<p>After setting the local password, you will manage Nano Server using PowerShell remoting.</p>
<div class="section" id="connecting-to-your-nano-server-instance-using-powershell-remoting">
<h3>Connecting to your Nano Server Instance using PowerShell Remoting<a class="headerlink" href="#connecting-to-your-nano-server-instance-using-powershell-remoting" title="Permalink to this headline">Â¶</a></h3>
<p>Open an elevated PowerShell window to add your remote Nano Server instance to your <code class="docutils literal"><span class="pre">TrustedHosts</span></code> list.</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span>$ip = &quot;10.83.181.14&quot; # replace with the correct IP address
Set-Item WSMan:\localhost\Client\TrustedHosts &quot;$ip&quot; -Concatenate -Force
</pre></div>
</div>
<p>Once you have added your Nano Server instance to your <code class="docutils literal"><span class="pre">TrustedHosts</span></code>, you can connect to it using PowerShell remoting</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span>$ip = &quot;10.83.181.14&quot; # replace with the correct IP address
$s = New-PSSession -ComputerName $ip -Credential ~\Administrator
Enter-PSSession $s
</pre></div>
</div>
<p>A successful connection results in a prompt with the following format: <code class="docutils literal"><span class="pre">[10.83.181.14]:</span> <span class="pre">PS</span> <span class="pre">C:\Users\Administrator\Documents&gt;</span></code></p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span><span class="n">Install</span><span class="o">-</span><span class="n">PackageProvider</span> <span class="n">NanoServerPackage</span>
<span class="n">Import</span><span class="o">-</span><span class="n">PackageProvider</span> <span class="n">NanoServerPackage</span>
<span class="n">Install</span><span class="o">-</span><span class="n">NanoServerPackage</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Microsoft</span><span class="o">-</span><span class="n">NanoServer</span><span class="o">-</span><span class="n">IIS</span><span class="o">-</span><span class="n">Package</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installing-the-asp-net-core-module">
<h2><a class="toc-backref" href="#id5">Installing the ASP.NET Core Module</a><a class="headerlink" href="#installing-the-asp-net-core-module" title="Permalink to this headline">Â¶</a></h2>
<p>The ASP.NET Core Module is an IIS 7.5+ module which is responsible for process management of ASP.NET Core HTTP listeners and to proxy requests to processes that it manages. At the moment, the process to install the ASP.NET Core Module for IIS is manual. You will need to install the version of the <a class="reference external" href="https://dot.net/">.NET Core Windows Server Hosting bundle</a> on a regular (not Nano) machine. After installing you will need to copy the following files:</p>
</div>
<div class="section" id="installing-iis">
<h2><a class="toc-backref" href="#id6">Installing IIS</a><a class="headerlink" href="#installing-iis" title="Permalink to this headline">Â¶</a></h2>
<p>Add the <code class="docutils literal"><span class="pre">NanoServerPackage</span></code> provider from the PowerShell gallery. Once the provider is installed and imported, you can install Windows packages.</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span><span class="n">Install</span><span class="o">-</span><span class="n">PackageProvider</span> <span class="n">NanoServerPackage</span>
<span class="n">Import</span><span class="o">-</span><span class="n">PackageProvider</span> <span class="n">NanoServerPackage</span>
<span class="n">Install</span><span class="o">-</span><span class="n">NanoServerPackage</span> <span class="o">-</span><span class="n">Name</span> <span class="n">Microsoft</span><span class="o">-</span><span class="n">NanoServer</span><span class="o">-</span><span class="n">IIS</span><span class="o">-</span><span class="n">Package</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id7">Installing the ASP.NET Core Module</a><a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h2>
<p>The ASP.NET Core Module is an IIS 7.5+ module which is responsible for process management of ASP.NET Core HTTP listeners and to proxy requests to processes that it manages. Currently, installing ASP.NET Core Module requires the following script:</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span>copy &lt;update-this&gt;\aspnetcore_schema.xml C:\windows\system32\inetsrv\config\schema
copy &lt;update-this&gt;\aspnetcore.dll C:\windows\system32\inetsrv

# Backup existing applicationHost.config
copy C:\Windows\System32\inetsrv\config\applicationHost.config C:\Windows\System32\inetsrv\config\applicationHost_BeforeInstallingANCM.config

Import-Module IISAdministration

# Initialize variables
$aspNetCoreHandlerFilePath=&quot;C:\windows\system32\inetsrv\aspnetcore.dll&quot;
Reset-IISServerManager -confirm:$false
$sm = Get-IISServerManager

# Add AppSettings section
$sm.GetApplicationHostConfiguration().RootSectionGroup.Sections.Add(&quot;appSettings&quot;)

# Set Allow for handlers section
$appHostconfig = $sm.GetApplicationHostConfiguration()
$section = $appHostconfig.GetSection(&quot;system.webServer/handlers&quot;)
$section.OverrideMode=&quot;Allow&quot;

# Add aspNetCore section to system.webServer
$sectionaspNetCore = $appHostConfig.RootSectionGroup.SectionGroups[&quot;system.webServer&quot;].Sections.Add(&quot;aspNetCore&quot;)
$sectionaspNetCore.OverrideModeDefault = &quot;Allow&quot;
$sm.CommitChanges()

# Configure globalModule
Reset-IISServerManager -confirm:$false
$globalModules = Get-IISConfigSection &quot;system.webServer/globalModules&quot; | Get-IISConfigCollection
New-IISConfigCollectionElement $globalModules -ConfigAttribute @{&quot;name&quot;=&quot;AspNetCoreModule&quot;;&quot;image&quot;=$aspNetCoreHandlerFilePath}

# Configure module
$modules = Get-IISConfigSection &quot;system.webServer/modules&quot; | Get-IISConfigCollection
New-IISConfigCollectionElement $modules -ConfigAttribute @{&quot;name&quot;=&quot;AspNetCoreModule&quot;}

# Backup existing applicationHost.config
copy C:\Windows\System32\inetsrv\config\applicationHost.config C:\Windows\System32\inetsrv\config\applicationHost_AfterInstallingANCM.config
</pre></div>
</div>
</div>
<div class="section" id="enabling-the-asp-net-core-module">
<h2><a class="toc-backref" href="#id8">Enabling the ASP.NET Core Module</a><a class="headerlink" href="#enabling-the-asp-net-core-module" title="Permalink to this headline">Â¶</a></h2>
<p>Execute the following PowerShell script in a remote PowerShell session to enable the HttpPlatformHandler module on the Nano server.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This script runs on a clean system but is not idempotent. Entries are added each time the script is run. You can restore <em>applicationHost.config</em> with backups from <em>%systemdrive%inetpubhistory</em>.</p>
</div>
<div class="highlight-ps1"><div class="highlight"><pre><span></span><span class="nb">Import-Module</span> <span class="n">IISAdministration</span> 

<span class="nv">$sm</span> <span class="p">=</span> <span class="nb">Get-IISServerManager</span>

<span class="c"># Add AppSettings section (for Asp.Net Core)</span>
<span class="nv">$sm</span><span class="p">.</span><span class="n">GetApplicationHostConfiguration</span><span class="p">().</span><span class="n">RootSectionGroup</span><span class="p">.</span><span class="n">Sections</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;appSettings&quot;</span><span class="p">)</span>

<span class="c"># Unlock handlers section</span>
<span class="nv">$appHostconfig</span> <span class="p">=</span> <span class="nv">$sm</span><span class="p">.</span><span class="n">GetApplicationHostConfiguration</span><span class="p">()</span>
<span class="nv">$section</span> <span class="p">=</span> <span class="nv">$appHostconfig</span><span class="p">.</span><span class="n">GetSection</span><span class="p">(</span><span class="s2">&quot;system.webServer/handlers&quot;</span><span class="p">)</span>
<span class="nv">$section</span><span class="p">.</span><span class="n">OverrideMode</span><span class="p">=</span><span class="s2">&quot;Allow&quot;</span>

<span class="c"># Add httpPlatform section to system.webServer</span>
<span class="nv">$sectionHttpPlatform</span> <span class="p">=</span> <span class="nv">$appHostConfig</span><span class="p">.</span><span class="n">RootSectionGroup</span><span class="p">.</span><span class="n">SectionGroups</span><span class="p">[</span><span class="s2">&quot;system.webServer&quot;</span><span class="p">].</span><span class="n">Sections</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;aspNetCore&quot;</span><span class="p">)</span>
<span class="nv">$sectionHttpPlatform</span><span class="p">.</span><span class="n">OverrideModeDefault</span> <span class="p">=</span> <span class="s2">&quot;Allow&quot;</span>

<span class="c"># Add to globalModules</span>
<span class="nv">$globalModules</span> <span class="p">=</span> <span class="nb">Get-IISConfigSection</span> <span class="s2">&quot;system.webServer/globalModules&quot;</span> <span class="p">|</span> <span class="nb">Get-IISConfigCollection</span>
<span class="nb">New-IISConfigCollectionElement</span> <span class="nv">$globalModules</span> <span class="n">-ConfigAttribute</span> <span class="p">@{</span><span class="s2">&quot;name&quot;</span><span class="p">=</span><span class="s2">&quot;AspNetCoreModule&quot;</span><span class="p">;</span><span class="s2">&quot;image&quot;</span><span class="p">=</span><span class="s2">&quot;%SystemRoot%\system32\inetsrv\aspnetcore.dll&quot;</span><span class="p">}</span>

<span class="c"># Add to modules</span>
<span class="nv">$modules</span> <span class="p">=</span> <span class="nb">Get-IISConfigSection</span> <span class="s2">&quot;system.webServer/modules&quot;</span> <span class="p">|</span> <span class="nb">Get-IISConfigCollection</span>
<span class="nb">New-IISConfigCollectionElement</span> <span class="nv">$modules</span> <span class="n">-ConfigAttribute</span> <span class="p">@{</span><span class="s2">&quot;name&quot;</span><span class="p">=</span><span class="s2">&quot;AspNetCoreModule&quot;</span><span class="p">}</span>
<span class="nv">$sm</span><span class="p">.</span><span class="n">CommitChanges</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="manually-editing-applicationhost-config">
<h3>Manually Editing <em>applicationHost.config</em><a class="headerlink" href="#manually-editing-applicationhost-config" title="Permalink to this headline">Â¶</a></h3>
<p>Skip this section if you ran the PowerShell script above. Running the PowerShell script above is the recommended approach to enabling the ASP.NET Core Module; alternatively you can edit the <em>applicationHost.config</em> file.</p>
<p>Open up <em>C:\Windows\System32\inetsrv\config\applicationHost.config</em></p>
<p>Under <code class="docutils literal"><span class="pre">&lt;configSections&gt;</span></code> add</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;configSections&gt;</span>
<span class="hll">    <span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">&quot;appSettings&quot;</span> <span class="nt">/&gt;</span>
</span></pre></div>
</div>
<p>In the <code class="docutils literal"><span class="pre">system.webServer</span></code> section group, update the handlers section to allow the configured handlers to be overridden.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sectionGroup</span> <span class="na">name=</span><span class="s">&quot;system.webServer&quot;</span><span class="nt">&gt;</span>
<span class="hll">    <span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">&quot;handlers&quot;</span> <span class="na">overrideModeDefault=</span><span class="s">&quot;Allow&quot;</span> <span class="nt">/&gt;</span>
</span></pre></div>
</div>
<p>Additionally, add <code class="docutils literal"><span class="pre">ASP.NET</span> <span class="pre">Core</span> <span class="pre">Module</span></code> to the <code class="docutils literal"><span class="pre">modules</span></code> section</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;modules&gt;</span>
<span class="hll">    <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;AspNetCoreModule&quot;</span> <span class="nt">/&gt;</span>
</span></pre></div>
</div>
</div>
</div>
<div class="section" id="installing-net-core-framework">
<h2><a class="toc-backref" href="#id9">Installing .NET Core Framework</a><a class="headerlink" href="#installing-net-core-framework" title="Permalink to this headline">Â¶</a></h2>
<p>If you published a portable app, .NET Core must be installed on the target machine. Execute the following Powershell script in a remote Powershell session to install the .NET Framework on your Nano Server.</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="nv">$SourcePath</span> <span class="p">=</span> <span class="s2">&quot;https://dotnetcli.blob.core.windows.net/dotnet/beta/Binaries/Latest/dotnet-win-x64.latest.zip&quot;</span>
<span class="nv">$DestinationPath</span> <span class="p">=</span> <span class="s2">&quot;C:\dotnet&quot;</span>

<span class="nv">$EditionId</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-ItemProperty</span> <span class="n">-Path</span> <span class="s1">&#39;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion&#39;</span> <span class="n">-Name</span> <span class="s1">&#39;EditionID&#39;</span><span class="p">).</span><span class="n">EditionId</span>

<span class="k">if</span> <span class="p">((</span><span class="nv">$EditionId</span> <span class="o">-eq</span> <span class="s2">&quot;ServerStandardNano&quot;</span><span class="p">)</span> <span class="o">-or</span>
    <span class="p">(</span><span class="nv">$EditionId</span> <span class="o">-eq</span> <span class="s2">&quot;ServerDataCenterNano&quot;</span><span class="p">)</span> <span class="o">-or</span>
    <span class="p">(</span><span class="nv">$EditionId</span> <span class="o">-eq</span> <span class="s2">&quot;NanoServer&quot;</span><span class="p">)</span> <span class="o">-or</span>
    <span class="p">(</span><span class="nv">$EditionId</span> <span class="o">-eq</span> <span class="s2">&quot;ServerTuva&quot;</span><span class="p">))</span> <span class="p">{</span>

    <span class="nv">$TempPath</span> <span class="p">=</span> <span class="no">[System.IO.Path]</span><span class="p">::</span><span class="n">GetTempFileName</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">((</span><span class="nv">$SourcePath</span> <span class="o">-as</span> <span class="no">[System.URI]</span><span class="p">).</span><span class="n">AbsoluteURI</span> <span class="o">-ne</span> <span class="nv">$null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$handler</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Http</span><span class="p">.</span><span class="n">HttpClientHandler</span>
        <span class="nv">$client</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Http</span><span class="p">.</span><span class="n">HttpClient</span><span class="p">(</span><span class="nv">$handler</span><span class="p">)</span>
        <span class="nv">$client</span><span class="p">.</span><span class="n">Timeout</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">TimeSpan</span><span class="p">(</span><span class="n">0</span><span class="p">,</span> <span class="n">30</span><span class="p">,</span> <span class="n">0</span><span class="p">)</span>
        <span class="nv">$cancelTokenSource</span> <span class="p">=</span> <span class="no">[System.Threading.CancellationTokenSource]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
        <span class="nv">$responseMsg</span> <span class="p">=</span> <span class="nv">$client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="no">[System.Uri]</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="nv">$SourcePath</span><span class="p">),</span> <span class="nv">$cancelTokenSource</span><span class="p">.</span><span class="n">Token</span><span class="p">)</span>
        <span class="nv">$responseMsg</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nv">$responseMsg</span><span class="p">.</span><span class="n">IsCanceled</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$response</span> <span class="p">=</span> <span class="nv">$responseMsg</span><span class="p">.</span><span class="n">Result</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$downloadedFileStream</span> <span class="p">=</span> <span class="no">[System.IO.FileStream]</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="nv">$TempPath</span><span class="p">,</span> <span class="no">[System.IO.FileMode]</span><span class="p">::</span><span class="n">Create</span><span class="p">,</span> <span class="no">[System.IO.FileAccess]</span><span class="p">::</span><span class="n">Write</span><span class="p">)</span>
                <span class="nv">$copyStreamOp</span> <span class="p">=</span> <span class="nv">$response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">CopyToAsync</span><span class="p">(</span><span class="nv">$downloadedFileStream</span><span class="p">)</span>
                <span class="nv">$copyStreamOp</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span>
                <span class="nv">$downloadedFileStream</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$copyStreamOp</span><span class="p">.</span><span class="n">Exception</span> <span class="o">-ne</span> <span class="nv">$null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="nv">$copyStreamOp</span><span class="p">.</span><span class="n">Exception</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="s2">&quot;Cannot copy from $SourcePath&quot;</span>
    <span class="p">}</span>
    <span class="no">[System.IO.Compression.ZipFile]</span><span class="p">::</span><span class="n">ExtractToDirectory</span><span class="p">(</span><span class="nv">$TempPath</span><span class="p">,</span> <span class="nv">$DestinationPath</span><span class="p">)</span>
    <span class="nb">Remove-Item</span> <span class="nv">$TempPath</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="publishing-the-application">
<h2><a class="toc-backref" href="#id10">Publishing the application</a><a class="headerlink" href="#publishing-the-application" title="Permalink to this headline">Â¶</a></h2>
<p>Copy over the published output of your existing application to the Nano server. You may need to make changes to your <em>web.config</em> to point to where you extracted <code class="docutils literal"><span class="pre">dotnet.exe</span></code>. Alternatively, you can add <code class="docutils literal"><span class="pre">dotnet.exe</span></code> to your path.</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span>$ip = &quot;10.83.181.14&quot; # replace with the correct IP address
$s = New-PSSession -ComputerName $ip -Credential ~\Administrator
Copy-Item -ToSession $s -Path &lt;path-to-src&gt;\bin\output\ -Destination C:\HelloAspNetCore -Recurse
</pre></div>
</div>
<p>You may also need to make the following OS changes:</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span>netsh advfirewall firewall set rule group=&quot;File and Printer Sharing&quot; new enable=yes
net share musicstore=c:\deployed\musicstore /GRANT:EVERYONE`,FULL
</pre></div>
</div>
<p>Use the following PowerShell snippet to create a new site in IIS for the published app. This script uses the <code class="docutils literal"><span class="pre">DefaultAppPool</span></code> for simplicity. For more considerations on running under an application pool, see <a class="reference internal" href="../hosting/apppool.html#apppool"><span class="std std-ref">Application Pools</span></a>.</p>
<div class="code powershell highlight-default"><div class="highlight"><pre><span></span><span class="n">Import</span><span class="o">-</span><span class="n">module</span> <span class="n">IISAdministration</span>
<span class="n">New</span><span class="o">-</span><span class="n">IISSite</span> <span class="o">-</span><span class="n">Name</span> <span class="s2">&quot;AspNetCore&quot;</span> <span class="o">-</span><span class="n">PhysicalPath</span> <span class="n">c</span><span class="p">:</span>\<span class="n">HelloAspNetCore</span>\ <span class="o">-</span><span class="n">BindingInformation</span> <span class="s2">&quot;*:8000:&quot;</span>
</pre></div>
</div>
<div class="section" id="id2">
<h3>Manually Editing <em>applicationHost.config</em><a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<p>You can also create the site by manually editing the <em>applicationHost.config</em> file.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;sites&gt;</span>
<span class="hll">    <span class="nt">&lt;site</span> <span class="na">name=</span><span class="s">&quot;AspNetCore&quot;</span> <span class="na">id=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;application</span> <span class="na">path=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;virtualDirectory</span> <span class="na">path=</span><span class="s">&quot;/&quot;</span> <span class="na">physicalPath=</span><span class="s">&quot;C:\HelloAspNetCore\wwwroot&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/application&gt;</span>
</span><span class="hll">        <span class="nt">&lt;bindings&gt;</span>
</span><span class="hll">            <span class="nt">&lt;binding</span> <span class="na">protocol=</span><span class="s">&quot;http&quot;</span> <span class="na">bindingInformation=</span><span class="s">&quot;*:8000:&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/bindings&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/site&gt;</span>
</span><span class="nt">&lt;/sites&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="open-a-port-in-the-firewall">
<h2><a class="toc-backref" href="#id11">Open a Port in the Firewall</a><a class="headerlink" href="#open-a-port-in-the-firewall" title="Permalink to this headline">Â¶</a></h2>
<p>Since we have IIS listening on port <strong>8000</strong> and forwarding request to our application, we will need open up the port to TCP traffic.</p>
<div class="code ps1 highlight-default"><div class="highlight"><pre><span></span><span class="n">New</span><span class="o">-</span><span class="n">NetFirewallRule</span> <span class="o">-</span><span class="n">Name</span> <span class="s2">&quot;AspNet5&quot;</span> <span class="o">-</span><span class="n">DisplayName</span> <span class="s2">&quot;HTTP on TCP/8000&quot;</span> <span class="o">-</span><span class="n">Protocol</span> <span class="n">TCP</span> <span class="o">-</span><span class="n">LocalPort</span> <span class="mi">8000</span> <span class="o">-</span><span class="n">Action</span> <span class="n">Allow</span> <span class="o">-</span><span class="n">Enabled</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-application">
<h2><a class="toc-backref" href="#id12">Running the Application</a><a class="headerlink" href="#running-the-application" title="Permalink to this headline">Â¶</a></h2>
<p>The published web app should be accessible in browser at <code class="docutils literal"><span class="pre">http://&lt;ip-address&gt;:8000</span></code>.
If you have set up logging as described in <a class="reference internal" href="../hosting/aspnet-core-module.html#log-redirection"><span class="std std-ref">Log creation and redirection</span></a>, you should be able to view your logs at <em>C:\HelloAspNetCore\logs</em>.</p>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mobile/native-mobile-backend.html" class="btn btn-neutral float-right" title="ðŸ”§ Creating Backend Services for Native Mobile Applications" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="first-mvc-app/details.html" class="btn btn-neutral" title="Examining the Details and Delete methods" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>