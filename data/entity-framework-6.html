

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started with ASP.NET Core and Entity Framework 6 &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../index.html"/>
        <link rel="up" title="Working with Data" href="index.html"/>
        <link rel="next" title="Azure Storage" href="azure-storage/index.html"/>
        <link rel="prev" title="Working with Data" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Working with Data</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting Started with ASP.NET Core and Entity Framework 6</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="http://docs.efproject.net/en/latest/platforms/aspnetcore/index.html">Getting Started With ASP.NET Core and Entity Framework Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure-storage/index.html">Azure Storage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Working with Data</a> &raquo;</li>
      
    <li>Getting Started with ASP.NET Core and Entity Framework 6</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/data/entity-framework-6.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="getting-started-with-asp-net-core-and-entity-framework-6">
<h1>Getting Started with ASP.NET Core and Entity Framework 6<a class="headerlink" href="#getting-started-with-asp-net-core-and-entity-framework-6" title="Permalink to this headline">¶</a></h1>
<p>By <a class="reference external" href="https://github.com/pgrudzien12">Paweł Grudzień</a> and <a class="reference external" href="https://github.com/DamienPontifex">Damien Pontifex</a></p>
<p>This article will show you how to use Entity Framework 6 inside an ASP.NET Core application.</p>
<div class="contents local topic" id="sections">
<p class="topic-title first">Sections:</p>
<ul class="simple">
<li><a class="reference internal" href="#prerequisites" id="id1">Prerequisites</a></li>
<li><a class="reference internal" href="#setup-connection-strings-and-dependency-injection" id="id2">Setup connection strings and dependency injection</a></li>
<li><a class="reference internal" href="#migrate-configuration-from-config-to-code" id="id3">Migrate configuration from config to code</a></li>
<li><a class="reference internal" href="#summary" id="id4">Summary</a></li>
<li><a class="reference internal" href="#additional-resources" id="id5">Additional Resources</a></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id1">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before you start, make sure that you compile against full .NET Framework in your project.json as Entity Framework 6 does not support .NET Core. If you need cross platform features you will need to upgrade to <a class="reference external" href="https://docs.efproject.net">Entity Framework Core</a>.</p>
<p>In your project.json file specify a single target for the full .NET Framework:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>&quot;frameworks&quot;: {
    &quot;net46&quot;: {}
}
</pre></div>
</div>
</div>
<div class="section" id="setup-connection-strings-and-dependency-injection">
<h2><a class="toc-backref" href="#id2">Setup connection strings and dependency injection</a><a class="headerlink" href="#setup-connection-strings-and-dependency-injection" title="Permalink to this headline">¶</a></h2>
<p>The simplest change is to explicitly get your connection string and setup dependency injection of your <code class="docutils literal"><span class="pre">DbContext</span></code> instance.</p>
<p>In your <code class="docutils literal"><span class="pre">DbContext</span></code> subclass, ensure you have a constructor which takes the connection string as so:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">ApplicationDbContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">ApplicationDbContext</span><span class="p">(</span><span class="kt">string</span> <span class="n">nameOrConnectionString</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">nameOrConnectionString</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>In the <code class="docutils literal"><span class="pre">Startup</span></code> class within <code class="docutils literal"><span class="pre">ConfigureServices</span></code> add factory method of your context with it&#8217;s connection string. Context should be resolved once per scope to ensure performance and ensure reliable operation of Entity Framework.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">ApplicationDbContext</span><span class="p">(</span><span class="n">Configuration</span><span class="p">[</span><span class="s">&quot;Data:DefaultConnection:ConnectionString&quot;</span><span class="p">]));</span>

    <span class="c1">// Configure remaining services</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="migrate-configuration-from-config-to-code">
<h2><a class="toc-backref" href="#id3">Migrate configuration from config to code</a><a class="headerlink" href="#migrate-configuration-from-config-to-code" title="Permalink to this headline">¶</a></h2>
<p>Entity Framework 6 allows configuration to be specified in xml (in web.config or app.config) or through code. As of ASP.NET Core, all configuration is code-based.</p>
<p>Code-based configuration is achieved by creating a subclass of <code class="docutils literal"><span class="pre">System.Data.Entity.Config.DbConfiguration</span></code> and applying <code class="docutils literal"><span class="pre">System.Data.Entity.DbConfigurationTypeAttribute</span></code> to your <code class="docutils literal"><span class="pre">DbContext</span></code> subclass.</p>
<p>Our config file typically looked like this:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;entityFramework&gt;</span>
    <span class="nt">&lt;defaultConnectionFactory</span> <span class="na">type=</span><span class="s">&quot;System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;parameters&gt;</span>
            <span class="nt">&lt;parameter</span> <span class="na">value=</span><span class="s">&quot;mssqllocaldb&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/parameters&gt;</span>
    <span class="nt">&lt;/defaultConnectionFactory&gt;</span>
    <span class="nt">&lt;providers&gt;</span>
        <span class="nt">&lt;provider</span> <span class="na">invariantName=</span><span class="s">&quot;System.Data.SqlClient&quot;</span> <span class="na">type=</span><span class="s">&quot;System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/providers&gt;</span>
<span class="nt">&lt;/entityFramework&gt;</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal"><span class="pre">defaultConnectionFactory</span></code> element sets the factory for connections. If this attribute is not set then the default value is <code class="docutils literal"><span class="pre">SqlConnectionProvider</span></code>. If, on the other hand, value is provided, the given class will be used to create <code class="docutils literal"><span class="pre">DbConnection</span></code> with its <code class="docutils literal"><span class="pre">CreateConnection</span></code> method. If the given factory has no default constructor then you must add parameters that are used to construct the object.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="na">[DbConfigurationType(typeof(CodeConfig))]</span> <span class="c1">// point to the class that inherit from DbConfiguration</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ApplicationDbContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
<span class="na">    [...]</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">CodeConfig</span> <span class="p">:</span> <span class="n">DbConfiguration</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">CodeConfig</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SetProviderServices</span><span class="p">(</span><span class="s">&quot;System.Data.SqlClient&quot;</span><span class="p">,</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Entity</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">.</span><span class="n">SqlProviderServices</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="sql-server-sql-server-express-and-localdb">
<h3>SQL Server, SQL Server Express and LocalDB<a class="headerlink" href="#sql-server-sql-server-express-and-localdb" title="Permalink to this headline">¶</a></h3>
<p>This is the default and so no explicit configuration is needed. The above <code class="docutils literal"><span class="pre">CodeConfig</span></code> class can be used to explicitly set the provider services and the appropriate connection string should be passed to the <code class="docutils literal"><span class="pre">DbContext</span></code> constructor as shown <a class="reference external" href="#setup-connection-strings-and-dependency-injection">above</a>.</p>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id4">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Entity Framework 6 is an object relational mapping (ORM) library, that is capable of mapping your classes to database entities with little effort. These features made it very popular so migrating large portions of code may be undesirable for many projects. This article shows how to avoid migration to focus on other new features of ASP.NET.</p>
</div>
<div class="section" id="additional-resources">
<h2><a class="toc-backref" href="#id5">Additional Resources</a><a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://msdn.microsoft.com/en-us/data/jj680699.aspx">Entity Framework - Code-Based Configuration</a></li>
</ul>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">✖</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="azure-storage/index.html" class="btn btn-neutral float-right" title="Azure Storage" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Working with Data" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>