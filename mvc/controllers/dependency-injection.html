

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dependency Injection and Controllers &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../../index.html"/>
        <link rel="up" title="Controllers" href="index.html"/>
        <link rel="next" title="Testing Controller Logic" href="testing.html"/>
        <link rel="prev" title="Filters" href="filters.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">MVC</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview.html">ðŸ”§ Overview of ASP.NET MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/index.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../views/index.html">Views</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Controllers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="actions.html">Controllers, Actions, and Action Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="routing.html">ðŸ”§ Routing to Controller Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.html">Filters</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Dependency Injection and Controllers</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Testing Controller Logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="areas.html">Areas</a></li>
<li class="toctree-l3"><a class="reference internal" href="application-model.html">ðŸ”§ Working with the Application Model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">MVC</a> &raquo;</li>
      
          <li><a href="index.html">Controllers</a> &raquo;</li>
      
    <li>Dependency Injection and Controllers</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/mvc/controllers/dependency-injection.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="dependency-injection-and-controllers">
<span id="dependency-injection-controllers"></span><h1>Dependency Injection and Controllers<a class="headerlink" href="#dependency-injection-and-controllers" title="Permalink to this headline">Â¶</a></h1>
<p>By <a class="reference external" href="http://ardalis.com">Steve Smith</a></p>
<p>ASP.NET Core MVC controllers should request their dependencies explicitly via their constructors. In some instances, individual controller actions may require a service, and it may not make sense to request at the controller level. In this case, you can also choose to inject a service as a parameter on the action method.</p>
<div class="contents local topic" id="sections">
<p class="topic-title first">Sections:</p>
<ul class="simple">
<li><a class="reference internal" href="#dependency-injection" id="id2">Dependency Injection</a></li>
<li><a class="reference internal" href="#constructor-injection" id="id3">Constructor Injection</a></li>
<li><a class="reference internal" href="#action-injection-with-fromservices" id="id4">Action Injection with FromServices</a></li>
<li><a class="reference internal" href="#accessing-settings-from-a-controller" id="id5">Accessing Settings from a Controller</a></li>
</ul>
</div>
<p><a class="reference external" href="https://github.com/aspnet/Docs/tree/master/aspnet/mvc/controllers/dependency-injection/sample">View or download sample code</a></p>
<div class="section" id="dependency-injection">
<h2><a class="toc-backref" href="#id2">Dependency Injection</a><a class="headerlink" href="#dependency-injection" title="Permalink to this headline">Â¶</a></h2>
<p>Dependency injection is a technique that follows the <a class="reference external" href="http://deviq.com/dependency-inversion-principle">Dependency Inversion Principle</a>, allowing for applications to be composed of loosely coupled modules. ASP.NET Core has built-in support for <a class="reference internal" href="../../fundamentals/dependency-injection.html"><span class="doc">dependency injection</span></a>, which makes applications easier to test and maintain.</p>
</div>
<div class="section" id="constructor-injection">
<h2><a class="toc-backref" href="#id3">Constructor Injection</a><a class="headerlink" href="#constructor-injection" title="Permalink to this headline">Â¶</a></h2>
<p>ASP.NET Core&#8217;s built-in support for constructor-based dependency injection extends to MVC controllers. By simply adding a service type to your controller as a constructor parameter, ASP.NET will attempt to resolve that type using its built in service container. Services are typically, but not always, defined using interfaces. For example, if your application has business logic that depends on the current time, you can inject a service that retrieves the time (rather than hard-coding it), which would allow your tests to pass in implementations that use a set time.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ControllerDI.Interfaces</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">IDateTime</span>
    <span class="p">{</span>
        <span class="n">DateTime</span> <span class="n">Now</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Implementing an interface like this one so that it uses the system clock at runtime is trivial:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ControllerDI.Interfaces</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ControllerDI.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SystemDateTime</span> <span class="p">:</span> <span class="n">IDateTime</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">Now</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>With this in place, we can use the service in our controller. In this case, we have added some logic to the <code class="docutils literal"><span class="pre">HomeController</span></code> <code class="docutils literal"><span class="pre">Index</span></code> method to display a greeting to the user based on the time of day.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">ControllerDI.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ControllerDI.Controllers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IDateTime</span> <span class="n">_dateTime</span><span class="p">;</span>
</span>
<span class="hll">        <span class="k">public</span> <span class="nf">HomeController</span><span class="p">(</span><span class="n">IDateTime</span> <span class="n">dateTime</span><span class="p">)</span>
</span>        <span class="p">{</span>
<span class="hll">            <span class="n">_dateTime</span> <span class="p">=</span> <span class="n">dateTime</span><span class="p">;</span>
</span>        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
        <span class="p">{</span>
<span class="hll">            <span class="kt">var</span> <span class="n">serverTime</span> <span class="p">=</span> <span class="n">_dateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="n">serverTime</span><span class="p">.</span><span class="n">Hour</span> <span class="p">&lt;</span> <span class="m">12</span><span class="p">)</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">                <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;Message&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;It&#39;s morning here - Good Morning!&quot;</span><span class="p">;</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">serverTime</span><span class="p">.</span><span class="n">Hour</span> <span class="p">&lt;</span> <span class="m">17</span><span class="p">)</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">                <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;Message&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;It&#39;s afternoon here - Good Afternoon!&quot;</span><span class="p">;</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">            <span class="k">else</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">                <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;Message&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;It&#39;s evening here - Good Evening!&quot;</span><span class="p">;</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">            <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>If we run the application now, we will most likely encounter an error:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">An</span> <span class="n">unhandled</span> <span class="n">exception</span> <span class="n">occurred</span> <span class="k">while</span> <span class="n">processing</span> <span class="n">the</span> <span class="n">request</span><span class="o">.</span>

<span class="n">InvalidOperationException</span><span class="p">:</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">resolve</span> <span class="n">service</span> <span class="k">for</span> <span class="nb">type</span> <span class="s1">&#39;ControllerDI.Interfaces.IDateTime&#39;</span> <span class="k">while</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">activate</span> <span class="s1">&#39;ControllerDI.Controllers.HomeController&#39;</span><span class="o">.</span>
<span class="n">Microsoft</span><span class="o">.</span><span class="n">Extensions</span><span class="o">.</span><span class="n">DependencyInjection</span><span class="o">.</span><span class="n">ActivatorUtilities</span><span class="o">.</span><span class="n">GetService</span><span class="p">(</span><span class="n">IServiceProvider</span> <span class="n">sp</span><span class="p">,</span> <span class="n">Type</span> <span class="nb">type</span><span class="p">,</span> <span class="n">Type</span> <span class="n">requiredBy</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">isDefaultParameterRequired</span><span class="p">)</span>
</pre></div>
</div>
<p>This error occurs when we have not configured a service in the <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method in our <code class="docutils literal"><span class="pre">Startup</span></code> class. To specify that requests for <code class="docutils literal"><span class="pre">IDateTime</span></code> should be resolved using an instance of <code class="docutils literal"><span class="pre">SystemDateTime</span></code>, add the highlighted line in the listing below to your <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>

    <span class="c1">// Add application services.</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IDateTime</span><span class="p">,</span> <span class="n">SystemDateTime</span><span class="p">&gt;();</span>
</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This particular service could be implemented using any of several different lifetime options (<code class="docutils literal"><span class="pre">Transient</span></code>, <code class="docutils literal"><span class="pre">Scoped</span></code>, or <code class="docutils literal"><span class="pre">Singleton</span></code>). See <a class="reference internal" href="../../fundamentals/dependency-injection.html"><span class="doc">Dependency Injection</span></a> to understand how each of these scope options will affect the behavior of your service.</p>
</div>
<p>Once the service has been configured, running the application and navigating to the home page should display the time-based message as expected:</p>
<img alt="../../_images/server-greeting.png" src="../../_images/server-greeting.png" />
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">See <a class="reference internal" href="../../testing/unit-testing.html"><span class="doc">Unit Testing</span></a> to learn how <a class="reference external" href="http://deviq.com/explicit-dependencies-principle">explicitly requesting dependencies</a> in controllers makes code easier to test.</p>
</div>
<p>ASP.NET Core&#8217;s built-in dependency injection supports having only a single constructor for classes requesting services. If you have more than one constructor, you may get an exception stating:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>An unhandled exception occurred while processing the request.

InvalidOperationException: Multiple constructors accepting all given argument types have been found in type &#39;ControllerDI.Controllers.HomeController&#39;. There should only be one applicable constructor.
Microsoft.Extensions.DependencyInjection.ActivatorUtilities.FindApplicableConstructor(Type instanceType, Type[] argumentTypes, ConstructorInfo&amp; matchingConstructor, Nullable`1[]&amp; parameterMap)
</pre></div>
</div>
<p>As the error message states, you can correct this problem having just a single constructor. You can also <a class="reference internal" href="../../fundamentals/dependency-injection.html#replacing-the-default-services-container"><span class="std std-ref">replace the default dependency injection support with a third party implementation</span></a>, many of which support multiple constructors.</p>
</div>
<div class="section" id="action-injection-with-fromservices">
<h2><a class="toc-backref" href="#id4">Action Injection with FromServices</a><a class="headerlink" href="#action-injection-with-fromservices" title="Permalink to this headline">Â¶</a></h2>
<p>Sometimes you don&#8217;t need a service for more than one action within your controller. In this case, it may make sense to inject the service as a parameter to the action method. This is done by marking the parameter with the attribute <code class="docutils literal"><span class="pre">[FromServices]</span></code> as shown here:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">About</span><span class="p">([</span><span class="n">FromServices</span><span class="p">]</span> <span class="n">IDateTime</span> <span class="n">dateTime</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;Message&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;Currently on the server the time is &quot;</span> <span class="p">+</span> <span class="n">dateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

    <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="accessing-settings-from-a-controller">
<h2><a class="toc-backref" href="#id5">Accessing Settings from a Controller</a><a class="headerlink" href="#accessing-settings-from-a-controller" title="Permalink to this headline">Â¶</a></h2>
<p>Accessing application or configuration settings from within a controller is a common pattern. This access should use the Options pattern described in <a class="reference internal" href="../../fundamentals/configuration.html"><span class="doc">configuration</span></a>. You generally should not request settings directly from your controller using dependency injection. A better approach is to request an <code class="docutils literal"><span class="pre">IOptions&lt;T&gt;</span></code> instance, where <code class="docutils literal"><span class="pre">T</span></code> is the configuration class you need.</p>
<p>To work with the options pattern, you need to create a class that represents the options, such as this one:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nn">ControllerDI.Model</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">SampleWebSettings</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Updates</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Then you need to configure the application to use the options model and add your configuration class to the services collection in <code class="docutils literal"><span class="pre">ConfigureServices</span></code>:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nf">Startup</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigurationBuilder</span><span class="p">()</span>
</span><span class="hll">        <span class="p">.</span><span class="n">AddJsonFile</span><span class="p">(</span><span class="s">&quot;samplewebsettings.json&quot;</span><span class="p">);</span>
</span><span class="hll">    <span class="n">Configuration</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
</span><span class="p">}</span>

<span class="hll"><span class="k">public</span> <span class="n">IConfigurationRoot</span> <span class="n">Configuration</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span>
<span class="c1">// This method gets called by the runtime. Use this method to add services to the container.</span>
<span class="c1">// For more information on how to configure your application, visit http://go.microsoft.com/fwlink/?LinkID=398940</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Required to use the Options&lt;T&gt; pattern</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddOptions</span><span class="p">();</span>
</span>
    <span class="c1">// Add settings from configuration</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">SampleWebSettings</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">);</span>
</span>
    <span class="c1">// Uncomment to add settings from code</span>
    <span class="c1">//services.Configure&lt;SampleWebSettings&gt;(settings =&gt;</span>
    <span class="c1">//{</span>
    <span class="c1">//    settings.Updates = 17;</span>
    <span class="c1">//});</span>

    <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>

    <span class="c1">// Add application services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IDateTime</span><span class="p">,</span> <span class="n">SystemDateTime</span><span class="p">&gt;();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above listing, we are configuring the application to read the settings from a JSON-formatted file. You can also configure the settings entirely in code, as is shown in the commented code above. See <a class="reference internal" href="../../fundamentals/configuration.html"><span class="doc">Configuration</span></a> for further configuration options.</p>
</div>
<p>Once you&#8217;ve specified a strongly-typed configuration object (in this case, <code class="docutils literal"><span class="pre">SampleWebSettings</span></code>) and added it to the services collection, you can request it from any Controller or Action method by requesting an instance of <code class="docutils literal"><span class="pre">IOptions&lt;T&gt;</span></code> (in this case, <code class="docutils literal"><span class="pre">IOptions&lt;SampleWebSettings&gt;</span></code>). The following code shows how one would request the settings from a controller:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SettingsController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">private</span> <span class="k">readonly</span> <span class="n">SampleWebSettings</span> <span class="n">_settings</span><span class="p">;</span>
</span>
<span class="hll">        <span class="k">public</span> <span class="nf">SettingsController</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">SampleWebSettings</span><span class="p">&gt;</span> <span class="n">settingsOptions</span> <span class="p">)</span>
</span>        <span class="p">{</span>
<span class="hll">            <span class="n">_settings</span> <span class="p">=</span> <span class="n">settingsOptions</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span>        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">_settings</span><span class="p">.</span><span class="n">Title</span><span class="p">;</span>
            <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;Updates&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">_settings</span><span class="p">.</span><span class="n">Updates</span><span class="p">;</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Following the Options pattern allows settings and configuration to be decoupled from one another, and ensures the controller is following <a class="reference external" href="http://deviq.com/separation-of-concerns/">separation of concerns</a>, since it doesn&#8217;t need to know how or where to find the settings information. It also makes the controller easier to <a class="reference internal" href="../../testing/unit-testing.html"><span class="doc">unit test</span></a>, since there is no <a class="reference external" href="http://deviq.com/static-cling/">static cling</a> or direct instantiation of settings classes within the controller class.</p>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing Controller Logic" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.html" class="btn btn-neutral" title="Filters" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>