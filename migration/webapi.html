

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Migrating from ASP.NET Web API &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../index.html"/>
        <link rel="up" title="Migration" href="index.html"/>
        <link rel="next" title="Migrating HTTP Modules to Middleware" href="http-modules.html"/>
        <link rel="prev" title="Migrating Authentication and Identity" href="identity.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Migration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mvc.html">Migrating From ASP.NET MVC to ASP.NET Core MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Migrating Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity.html">Migrating Authentication and Identity</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Migrating from ASP.NET Web API</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="http-modules.html">Migrating HTTP Modules to Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="rc1-to-rc2.html">Migrating from ASP.NET 5 RC1 to ASP.NET Core</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Migration</a> &raquo;</li>
      
    <li>Migrating from ASP.NET Web API</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/migration/webapi.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="migrating-from-asp-net-web-api">
<h1>Migrating from ASP.NET Web API<a class="headerlink" href="#migrating-from-asp-net-web-api" title="Permalink to this headline">¶</a></h1>
<p>By <a class="reference external" href="http://ardalis.com">Steve Smith</a> and <a class="reference external" href="http://scottaddie.com">Scott Addie</a></p>
<p>Web APIs are HTTP services that reach a broad range of clients, including browsers and mobile devices. ASP.NET Core MVC includes support for building Web APIs providing a single, consistent way of building web applications. In this article, we demonstrate the steps required to migrate a Web API implementation from ASP.NET Web API to ASP.NET Core MVC.</p>
<div class="contents local topic" id="sections">
<p class="topic-title first">Sections::</p>
<ul class="simple">
<li><a class="reference internal" href="#review-asp-net-web-api-project" id="id1">Review ASP.NET Web API Project</a></li>
<li><a class="reference internal" href="#create-the-destination-project" id="id2">Create the Destination Project</a></li>
<li><a class="reference internal" href="#migrate-configuration" id="id3">Migrate Configuration</a></li>
<li><a class="reference internal" href="#migrate-models-and-controllers" id="id4">Migrate Models and Controllers</a></li>
<li><a class="reference internal" href="#summary" id="id5">Summary</a></li>
</ul>
</div>
<p><a class="reference external" href="https://github.com/aspnet/Docs/tree/master/aspnet/migration/webapi/sample">View or download sample code</a></p>
<div class="section" id="review-asp-net-web-api-project">
<h2><a class="toc-backref" href="#id1">Review ASP.NET Web API Project</a><a class="headerlink" href="#review-asp-net-web-api-project" title="Permalink to this headline">¶</a></h2>
<p>This article uses the sample project, <em>ProductsApp</em>, created in the article <a class="reference external" href="http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api">Getting Started with ASP.NET Web API</a> as its starting point. In that project, a simple ASP.NET Web API  project is configured as follows.</p>
<p>In <em>Global.asax.cs</em>, a call is made to <code class="docutils literal"><span class="pre">WebApiConfig.Register</span></code>:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Routing</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductsApp</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">WebApiApplication</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">HttpApplication</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">()</span>
        <span class="p">{</span>
<span class="hll">            <span class="n">GlobalConfiguration</span><span class="p">.</span><span class="n">Configure</span><span class="p">(</span><span class="n">WebApiConfig</span><span class="p">.</span><span class="n">Register</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal"><span class="pre">WebApiConfig</span></code> is defined in <em>App_Start</em>, and has just one static <code class="docutils literal"><span class="pre">Register</span></code> method:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductsApp</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">WebApiConfig</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">HttpConfiguration</span> <span class="n">config</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Web API configuration and services</span>

            <span class="c1">// Web API routes</span>
<span class="hll">            <span class="n">config</span><span class="p">.</span><span class="n">MapHttpAttributeRoutes</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll">            <span class="n">config</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">MapHttpRoute</span><span class="p">(</span>
</span><span class="hll">                <span class="n">name</span><span class="p">:</span> <span class="s">&quot;DefaultApi&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="n">routeTemplate</span><span class="p">:</span> <span class="s">&quot;api/{controller}/{id}&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="n">defaults</span><span class="p">:</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">RouteParameter</span><span class="p">.</span><span class="n">Optional</span> <span class="p">}</span>
</span>            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This class configures <a class="reference external" href="http://www.asp.net/web-api/overview/web-api-routing-and-actions/attribute-routing-in-web-api-2">attribute routing</a>, although it&#8217;s not actually being used in the project. It also configures the routing table which is used by ASP.NET Web API. In this case, ASP.NET Web API will expect URLs to match the format <em>/api/{controller}/{id}</em>, with <em>{id}</em> being optional.</p>
<p>The <em>ProductsApp</em> project includes just one simple controller, which inherits from <code class="docutils literal"><span class="pre">ApiController</span></code> and exposes two methods:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">ProductsApp.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductsApp.Controllers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductsController</span> <span class="p">:</span> <span class="n">ApiController</span>
    <span class="p">{</span>
        <span class="n">Product</span><span class="p">[]</span> <span class="n">products</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Product</span><span class="p">[]</span> 
        <span class="p">{</span> 
            <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Tomato Soup&quot;</span><span class="p">,</span> <span class="n">Category</span> <span class="p">=</span> <span class="s">&quot;Groceries&quot;</span><span class="p">,</span> <span class="n">Price</span> <span class="p">=</span> <span class="m">1</span> <span class="p">},</span> 
            <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Yo-yo&quot;</span><span class="p">,</span> <span class="n">Category</span> <span class="p">=</span> <span class="s">&quot;Toys&quot;</span><span class="p">,</span> <span class="n">Price</span> <span class="p">=</span> <span class="m">3.75</span><span class="n">M</span> <span class="p">},</span> 
            <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Hammer&quot;</span><span class="p">,</span> <span class="n">Category</span> <span class="p">=</span> <span class="s">&quot;Hardware&quot;</span><span class="p">,</span> <span class="n">Price</span> <span class="p">=</span> <span class="m">16.99</span><span class="n">M</span> <span class="p">}</span> 
        <span class="p">};</span>

<span class="hll">        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="n">GetAllProducts</span><span class="p">()</span>
</span>        <span class="p">{</span>
            <span class="k">return</span> <span class="n">products</span><span class="p">;</span>
        <span class="p">}</span>

<span class="hll">        <span class="k">public</span> <span class="n">IHttpActionResult</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span>        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="n">products</span><span class="p">.</span><span class="n">FirstOrDefault</span><span class="p">((</span><span class="n">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Finally, the model, <em>Product</em>, used by the <em>ProductsApp</em>, is a simple class:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nn">ProductsApp.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Product</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Category</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Now that we have a simple project from which to start, we can demonstrate how to migrate this Web API project to ASP.NET Core MVC.</p>
</div>
<div class="section" id="create-the-destination-project">
<h2><a class="toc-backref" href="#id2">Create the Destination Project</a><a class="headerlink" href="#create-the-destination-project" title="Permalink to this headline">¶</a></h2>
<p>Using Visual Studio, create a new, empty solution, and add the existing <em>ProductsApp</em> project to it. Then, add a new Web Project to the solution. Name the new project &#8216;ProductsCore&#8217;.</p>
<img alt="../_images/add-web-project.png" src="../_images/add-web-project.png" />
<p>Next, choose the ASP.NET Core Web API project template. We will migrate the <em>ProductsApp</em> contents to this new project.</p>
<img alt="../_images/aspnet-5-webapi.png" src="../_images/aspnet-5-webapi.png" />
<p>Delete the <code class="docutils literal"><span class="pre">Project_Readme.html</span></code> file from the new project. Your solution should now look like this:</p>
<img alt="../_images/webapimigration-solution.png" src="../_images/webapimigration-solution.png" />
</div>
<div class="section" id="migrate-configuration">
<h2><a class="toc-backref" href="#id3">Migrate Configuration</a><a class="headerlink" href="#migrate-configuration" title="Permalink to this headline">¶</a></h2>
<p>ASP.NET Core no longer uses <em>Global.asax</em>, <em>web.config</em>, or <em>App_Start</em> folders. Instead, all startup tasks are done in <em>Startup.cs</em> in the root of the project (see <a class="reference internal" href="../fundamentals/startup.html"><span class="doc">Application Startup</span></a>). In ASP.NET Core MVC attribute-based routing is now included by default when <code class="docutils literal"><span class="pre">UseMvc()</span></code> is called and this is the recommended approach for configuring Web API routes (and is how the Web API starter project handles routing).</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Builder</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Hosting</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Configuration</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Logging</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductsCore</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">Startup</span><span class="p">(</span><span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Set up configuration sources.</span>
            <span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigurationBuilder</span><span class="p">()</span>
                <span class="p">.</span><span class="n">AddJsonFile</span><span class="p">(</span><span class="s">&quot;appsettings.json&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="n">AddEnvironmentVariables</span><span class="p">();</span>
            <span class="n">Configuration</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IConfigurationRoot</span> <span class="n">Configuration</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="c1">// This method gets called by the runtime. Use this method to add services to the container.</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Add framework services.</span>
            <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">,</span> <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">loggerFactory</span><span class="p">.</span><span class="n">AddConsole</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetSection</span><span class="p">(</span><span class="s">&quot;Logging&quot;</span><span class="p">));</span>
            <span class="n">loggerFactory</span><span class="p">.</span><span class="n">AddDebug</span><span class="p">();</span>

            <span class="n">app</span><span class="p">.</span><span class="n">UseIISPlatformHandler</span><span class="p">();</span>

            <span class="n">app</span><span class="p">.</span><span class="n">UseStaticFiles</span><span class="p">();</span>

<span class="hll">            <span class="n">app</span><span class="p">.</span><span class="n">UseMvc</span><span class="p">();</span>
</span>        <span class="p">}</span>

        <span class="c1">// Entry point for the application.</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">WebApplication</span><span class="p">.</span><span class="n">Run</span><span class="p">&lt;</span><span class="n">Startup</span><span class="p">&gt;(</span><span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Assuming you want to use attribute routing in your project going forward, no additional configuration is needed. Simply apply the attributes as needed to your controllers and actions, as is done in the sample <code class="docutils literal"><span class="pre">ValuesController</span></code> class that is included in the Web API starter project:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductsCore.Controllers</span>
<span class="p">{</span>
<span class="hll"><span class="na">    [Route(&quot;api/[controller]</span><span class="s">&quot;)]</span>
</span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ValuesController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="c1">// GET: api/values</span>
<span class="hll"><span class="na">        [HttpGet]</span>
</span>        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Get</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&quot;value1&quot;</span><span class="p">,</span> <span class="s">&quot;value2&quot;</span> <span class="p">};</span>
        <span class="p">}</span>

        <span class="c1">// GET api/values/5</span>
<span class="hll"><span class="na">        [HttpGet(&quot;{id}&quot;)]</span>
</span>        <span class="k">public</span> <span class="kt">string</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;value&quot;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// POST api/values</span>
<span class="hll"><span class="na">        [HttpPost]</span>
</span>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="c1">// PUT api/values/5</span>
<span class="hll"><span class="na">        [HttpPut(&quot;{id}&quot;)]</span>
</span>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Put</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">FromBody</span><span class="p">]</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="c1">// DELETE api/values/5</span>
<span class="hll"><span class="na">        [HttpDelete(&quot;{id}&quot;)]</span>
</span>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Delete</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Note the presence of <em>[controller]</em> on line 8. Attribute-based routing now supports certain tokens, such as <em>[controller]</em> and <em>[action]</em>. These tokens are replaced at runtime with the name of the controller or action, respectively, to which the attribute has been applied. This serves to reduce the number of magic strings in the project, and it ensures the routes will be kept synchronized with their corresponding controllers and actions when automatic rename refactorings are applied.</p>
<p>To migrate the Products API controller, we must first copy <em>ProductsController</em> to the new project. Then simply include the route attribute on the controller:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="na">[Route(&quot;api/[controller]</span><span class="s">&quot;)]</span>
</pre></div>
</div>
<p>You also need to add the <code class="docutils literal"><span class="pre">[HttpGet]</span></code> attribute to the two methods, since they both should be called via HTTP Get. Include the expectation of an &#8220;id&#8221; parameter in the attribute for <code class="docutils literal"><span class="pre">GetProduct()</span></code>:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="c1">// /api/products</span>
<span class="na">[HttpGet]</span>
<span class="p">...</span>

<span class="c1">// /api/products/1</span>
<span class="na">[HttpGet(&quot;{id}&quot;)]</span>
</pre></div>
</div>
<p>At this point, routing is configured correctly; however, we can&#8217;t yet test it. Additional changes must be made before <em>ProductsController</em> will compile.</p>
</div>
<div class="section" id="migrate-models-and-controllers">
<h2><a class="toc-backref" href="#id4">Migrate Models and Controllers</a><a class="headerlink" href="#migrate-models-and-controllers" title="Permalink to this headline">¶</a></h2>
<p>The last step in the migration process for this simple Web API project is to copy over the Controllers and any Models they use. In this case, simply copy <em>Controllers/ProductsController.cs</em> from the original project to the new one. Then, copy the entire Models folder from the original project to the new one. Adjust the namespaces to match the new project name (<cite>ProductsCore</cite>).  At this point, you can build the application, and you will find a number of compilation errors. These should generally fall into the following categories:</p>
<ul class="simple">
<li><cite>ApiController</cite> does not exist</li>
<li><cite>System.Web.Http</cite> namespace does not exist</li>
<li><cite>IHttpActionResult</cite> does not exist</li>
<li><cite>NotFound</cite> does not exist</li>
<li><cite>Ok</cite> does not exist</li>
</ul>
<p>Fortunately, these are all very easy to correct:</p>
<ul class="simple">
<li>Change <cite>ApiController</cite> to <cite>Controller</cite> (you may need to add <cite>using Microsoft.AspNetCore.Mvc</cite>)</li>
<li>Delete any using statement referring to <cite>System.Web.Http</cite></li>
<li>Change any method returning <cite>IHttpActionResult</cite> to return a <cite>IActionResult</cite></li>
<li>Change <cite>NotFound</cite> to <cite>HttpNotFound</cite></li>
<li>Change <cite>Ok(product)</cite> to <cite>new ObjectResult(product)</cite></li>
</ul>
<p>Once these changes have been made and unused using statements removed, the migrated <em>ProductsController</em> class looks like this:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="k">using</span> <span class="nn">Microsoft.AspNet.Mvc</span><span class="p">;</span>
</span><span class="hll"><span class="k">using</span> <span class="nn">ProductsCore.Models</span><span class="p">;</span>
</span><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>

<span class="hll"><span class="k">namespace</span> <span class="nn">ProductsCore.Controllers</span>
</span><span class="p">{</span>
<span class="hll"><span class="na">    [Route(&quot;api/[controller]</span><span class="s">&quot;)]</span>
</span><span class="hll">    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductsController</span> <span class="p">:</span> <span class="n">Controller</span>
</span>    <span class="p">{</span>
        <span class="n">Product</span><span class="p">[]</span> <span class="n">products</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Product</span><span class="p">[]</span> 
        <span class="p">{</span> 
            <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Tomato Soup&quot;</span><span class="p">,</span> <span class="n">Category</span> <span class="p">=</span> <span class="s">&quot;Groceries&quot;</span><span class="p">,</span> <span class="n">Price</span> <span class="p">=</span> <span class="m">1</span> <span class="p">},</span> 
            <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Yo-yo&quot;</span><span class="p">,</span> <span class="n">Category</span> <span class="p">=</span> <span class="s">&quot;Toys&quot;</span><span class="p">,</span> <span class="n">Price</span> <span class="p">=</span> <span class="m">3.75</span><span class="n">M</span> <span class="p">},</span> 
            <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Hammer&quot;</span><span class="p">,</span> <span class="n">Category</span> <span class="p">=</span> <span class="s">&quot;Hardware&quot;</span><span class="p">,</span> <span class="n">Price</span> <span class="p">=</span> <span class="m">16.99</span><span class="n">M</span> <span class="p">}</span> 
        <span class="p">};</span>

        <span class="c1">// /api/products</span>
<span class="na">        [HttpGet]</span>
        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="n">GetAllProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">products</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// /api/products/1</span>
<span class="na">        [HttpGet(&quot;{id}&quot;)]</span>
<span class="hll">        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span>        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="n">products</span><span class="p">.</span><span class="n">FirstOrDefault</span><span class="p">((</span><span class="n">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
<span class="hll">                <span class="k">return</span> <span class="nf">HttpNotFound</span><span class="p">();</span>
</span>            <span class="p">}</span>
<span class="hll">            <span class="k">return</span> <span class="k">new</span> <span class="nf">ObjectResult</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>You should now be able to run the migrated project and browse to <em>/api/products</em>; and, you should see the full list of 3 products. Browse to <em>/api/products/1</em> and you should see the first product.</p>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id5">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Migrating a simple ASP.NET Web API project to ASP.NET Core MVC is fairly straightforward, thanks to the built-in support for Web APIs in ASP.NET Core MVC. The main pieces every ASP.NET Web API project will need to migrate are routes, controllers, and models, along with updates to the types used by  controllers and actions.</p>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">✖</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="http-modules.html" class="btn btn-neutral float-right" title="Migrating HTTP Modules to Middleware" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="identity.html" class="btn btn-neutral" title="Migrating Authentication and Identity" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>