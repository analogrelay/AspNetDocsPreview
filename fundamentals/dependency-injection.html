

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dependency Injection &mdash; ASP.NET  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=6" type="text/css" />
  

  
    <link rel="top" title="ASP.NET  documentation" href="../index.html"/>
        <link rel="up" title="Fundamentals" href="index.html"/>
        <link rel="next" title="Working with Multiple Environments" href="environments.html"/>
        <link rel="prev" title="ðŸ”§ File Providers" href="file-providers.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.asp.net/projects/api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Fundamentals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="startup.html">Application Startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="static-files.html">Working with Static Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing.html">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="localization.html">Globalization and localization</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="file-providers.html">ðŸ”§ File Providers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Dependency Injection</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Working with Multiple Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="app-state.html">Managing Application State</a></li>
<li class="toctree-l2"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="request-features.html">Request Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="owin.html">OWIN</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mvc/index.html">MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hosting/index.html">Guidance for Hosting Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Fundamentals</a> &raquo;</li>
      
    <li>Dependency Injection</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/fundamentals/dependency-injection.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="dependency-injection">
<span id="fundamentals-dependency-injection"></span><h1>Dependency Injection<a class="headerlink" href="#dependency-injection" title="Permalink to this headline">Â¶</a></h1>
<p><a class="reference external" href="http://ardalis.com">Steve Smith</a></p>
<p>ASP.NET Core is designed from the ground up to support and leverage dependency injection. ASP.NET Core applications can leverage built-in framework services by having them injected into methods in the Startup class, and application services can be configured for injection as well. The default services container provided by ASP.NET Core provides a minimal feature set and is not intended to replace other containers.</p>
<div class="contents local topic" id="sections">
<p class="topic-title first">Sections:</p>
<ul class="simple">
<li><a class="reference internal" href="#what-is-dependency-injection" id="id5">What is Dependency Injection?</a></li>
<li><a class="reference internal" href="#using-framework-provided-services" id="id6">Using Framework-Provided Services</a></li>
<li><a class="reference internal" href="#registering-your-own-services" id="id7">Registering Your Own Services</a></li>
<li><a class="reference internal" href="#service-lifetimes-and-registration-options" id="id8">Service Lifetimes and Registration Options</a></li>
<li><a class="reference internal" href="#request-services" id="id9">Request Services</a></li>
<li><a class="reference internal" href="#designing-your-services-for-dependency-injection" id="id10">Designing Your Services For Dependency Injection</a></li>
<li><a class="reference internal" href="#replacing-the-default-services-container" id="id11">Replacing the default services container</a></li>
<li><a class="reference internal" href="#recommendations" id="id12">Recommendations</a></li>
<li><a class="reference internal" href="#additional-resources" id="id13">Additional Resources</a></li>
</ul>
</div>
<p><a class="reference external" href="https://github.com/aspnet/Docs/tree/master/aspnet/fundamentals/dependency-injection/sample">View or download sample code</a></p>
<div class="section" id="what-is-dependency-injection">
<h2><a class="toc-backref" href="#id5">What is Dependency Injection?</a><a class="headerlink" href="#what-is-dependency-injection" title="Permalink to this headline">Â¶</a></h2>
<p>Dependency injection (DI) is a technique for achieving loose coupling between objects and their collaborators, or dependencies. Rather than directly instantiating collaborators, or using static references, the objects a class needs in order to perform its actions are provided to the class in some fashion. Most often, classes will declare their dependencies via their constructor, allowing them to follow the <a class="reference external" href="http://deviq.com/explicit-dependencies-principle/">Explicit Dependencies Principle</a>. This approach is known as &#8220;constructor injection&#8221;.</p>
<p>When classes are designed with DI in mind, they are more loosely coupled because they do not have direct, hard-coded dependencies on their collaborators. This follows the <a class="reference external" href="http://deviq.com/dependency-inversion-principle/">Dependency Inversion Principle</a>, which states that <em>&#8220;high level modules should not depend on low level modules; both should depend on abstractions.&#8221;</em> Instead of referencing specific implementations, classes request abstractions (typically <code class="docutils literal"><span class="pre">interfaces</span></code>) which are provided to them when they are constructed. Extracting dependencies into interfaces and providing implementations of these interfaces as parameters is also an example of the <a class="reference external" href="http://deviq.com/strategy-design-pattern/">Strategy design pattern</a>.</p>
<p>When a system is designed to use DI, with many classes requesting their dependencies via their constructor (or properties), it&#8217;s helpful to have a class dedicated to creating these classes with their associated dependencies. These classes are referred to as <em>containers</em>, or more specifically, <a class="reference external" href="http://deviq.com/inversion-of-control/">Inversion of Control (IoC)</a> containers or Dependency Injection (DI) containers. A container is essentially a factory that is responsible for providing instances of types that are requested from it. If a given type has declared that it has dependencies, and the container has been configured to provide the dependency types, it will create the dependencies as part of creating the requested instance. In this way, complex dependency graphs can be provided to classes without the need for any hard-coded object construction. In addition to creating objects with their dependencies, containers typically manage object lifetimes within the application.</p>
<p>ASP.NET Core includes a simple built-in container (represented by the <code class="docutils literal"><span class="pre">IServiceProvider</span></code> interface) that supports constructor injection by default, and ASP.NET makes certain services available through DI. ASP.NET&#8217;s container refers to the types it manages as <em>services</em>. Throughout the rest of this article, <em>services</em> will refer to types that are managed by ASP.NET Core&#8217;s IoC container. You configure the built-in container&#8217;s services in the <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method in your application&#8217;s <code class="docutils literal"><span class="pre">Startup</span></code> class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Martin Fowler has written an extensive article on <a class="reference external" href="http://www.martinfowler.com/articles/injection.html">Inversion of Control Containers and the Dependency Injection Pattern</a>. Microsoft Patterns and Practices also has a great description of <a class="reference external" href="https://msdn.microsoft.com/en-us/library/dn178469(v=pandp.30).aspx">Dependency Injection</a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This article covers Dependency Injection as it applies to all ASP.NET applications. Dependency Injection within MVC controllers is covered in <a class="reference internal" href="../mvc/controllers/dependency-injection.html"><span class="doc">Dependency Injection and Controllers</span></a>.</p>
</div>
</div>
<div class="section" id="using-framework-provided-services">
<h2><a class="toc-backref" href="#id6">Using Framework-Provided Services</a><a class="headerlink" href="#using-framework-provided-services" title="Permalink to this headline">Â¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method in the <code class="docutils literal"><span class="pre">Startup</span></code> class is responsible for defining the services the application will use, including platform features like Entity Framework Core and ASP.NET Core MVC. Initially, the <code class="docutils literal"><span class="pre">IServiceCollection</span></code> provided to <code class="docutils literal"><span class="pre">ConfigureServices</span></code> has just a handful of services defined. Below is an example of how to add additional services to the container using a number of extensions methods like <code class="docutils literal"><span class="pre">AddDbContext</span></code>, <code class="docutils literal"><span class="pre">AddIdentity</span></code>, and <code class="docutils literal"><span class="pre">AddMvc</span></code>.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="c1">// This method gets called by the runtime. Use this method to add services to the container.</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Add framework services.</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
</span>        <span class="n">options</span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetConnectionString</span><span class="p">(</span><span class="s">&quot;DefaultConnection&quot;</span><span class="p">)));</span>

<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddIdentity</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">,</span> <span class="n">IdentityRole</span><span class="p">&gt;()</span>
</span>        <span class="p">.</span><span class="n">AddEntityFrameworkStores</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;()</span>
        <span class="p">.</span><span class="n">AddDefaultTokenProviders</span><span class="p">();</span>

<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>
</span>
    <span class="c1">// Add application services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IEmailSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ISmsSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The features and middleware provided by ASP.NET, such as MVC, follow a convention of using a single Add<em>Service</em> extension method to register all of the services required by that feature.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can request certain framework-provided services within <code class="docutils literal"><span class="pre">Startup</span></code> methods through their parameter lists - see <a class="reference internal" href="startup.html"><span class="doc">Application Startup</span></a> for more details.</p>
</div>
<p>Of course, in addition to configuring the application to take advantage of various framework features, you can also use <code class="docutils literal"><span class="pre">ConfigureServices</span></code> to configure your own application services.</p>
</div>
<div class="section" id="registering-your-own-services">
<h2><a class="toc-backref" href="#id7">Registering Your Own Services</a><a class="headerlink" href="#registering-your-own-services" title="Permalink to this headline">Â¶</a></h2>
<p>You can register your own application services as follows. The first generic type represents the type (typically an interface) that will be requested from the container. The second generic type represents the concrete type that will be instantiated by the container and used to fulfill such requests.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ISmsSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each <code class="docutils literal"><span class="pre">services.Add&lt;service&gt;</span></code> calls adds (and potentially configures) services. For example, <code class="docutils literal"><span class="pre">services.AddMvc()</span></code> adds the services MVC requires.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">AddTransient</span></code> method is used to map abstract types to concrete services that are instantiated separately for every object that requires it. This is known as the service&#8217;s <em>lifetime</em>, and additional lifetime options are described below. It is important to choose an appropriate lifetime for each of the services you register. Should a new instance of the service be provided to each class that requests it? Should one instance be used throughout a given web request? Or should a single instance be used for the lifetime of the application?</p>
<p>In the sample for this article, there is a simple controller that displays character names, called <code class="docutils literal"><span class="pre">CharactersController</span></code>. Its <code class="docutils literal"><span class="pre">Index</span></code> method displays the current list of characters that have been stored in the application, and initializes the collection with a handful of characters if none exist. Note that although this application uses Entity Framework Core and the <code class="docutils literal"><span class="pre">ApplicationDbContext</span></code> class for its persistence, none of that is apparent in the controller. Instead, the specific data access mechanism has been abstracted behind an interface, <code class="docutils literal"><span class="pre">ICharacterRepository</span></code>, which follows the <a class="reference external" href="http://deviq.com/repository-pattern/">repository pattern</a>. An instance of <code class="docutils literal"><span class="pre">ICharacterRepository</span></code> is requested via the constructor and assigned to a private field, which is then used to access characters as necessary.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">CharactersController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
<span class="hll">    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ICharacterRepository</span> <span class="n">_characterRepository</span><span class="p">;</span>
</span>
<span class="hll">    <span class="k">public</span> <span class="nf">CharactersController</span><span class="p">(</span><span class="n">ICharacterRepository</span> <span class="n">characterRepository</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">_characterRepository</span> <span class="p">=</span> <span class="n">characterRepository</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="c1">// GET: /characters/</span>
    <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">PopulateCharactersIfNoneExist</span><span class="p">();</span>
<span class="hll">        <span class="kt">var</span> <span class="n">characters</span> <span class="p">=</span> <span class="n">_characterRepository</span><span class="p">.</span><span class="n">ListAll</span><span class="p">();</span>
</span>
        <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">characters</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">PopulateCharactersIfNoneExist</span><span class="p">()</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">if</span> <span class="p">(!</span><span class="n">_characterRepository</span><span class="p">.</span><span class="n">ListAll</span><span class="p">().</span><span class="n">Any</span><span class="p">())</span>
</span>        <span class="p">{</span>
<span class="hll">            <span class="n">_characterRepository</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Character</span><span class="p">(</span><span class="s">&quot;Darth Maul&quot;</span><span class="p">));</span>
</span><span class="hll">            <span class="n">_characterRepository</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Character</span><span class="p">(</span><span class="s">&quot;Darth Vader&quot;</span><span class="p">));</span>
</span><span class="hll">            <span class="n">_characterRepository</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Character</span><span class="p">(</span><span class="s">&quot;Yoda&quot;</span><span class="p">));</span>
</span><span class="hll">            <span class="n">_characterRepository</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Character</span><span class="p">(</span><span class="s">&quot;Mace Windu&quot;</span><span class="p">));</span>
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <cite>ICharacterRepository</cite> simply defines the two methods the controller needs to work with <cite>Character</cite> instances.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">DependencyInjectionSample.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DependencyInjectionSample.Interfaces</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">ICharacterRepository</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Character</span><span class="p">&gt;</span> <span class="n">ListAll</span><span class="p">();</span>
</span><span class="hll">        <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="n">Character</span> <span class="n">character</span><span class="p">);</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This interface is in turn implemented by a concrete type, <code class="docutils literal"><span class="pre">CharacterRepository</span></code>, that is used at runtime.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The way DI is used with the <code class="docutils literal"><span class="pre">CharacterRepository</span></code> class is a general model you can follow for all of your application services, not just in &#8220;repositories&#8221; or data access classes.</p>
</div>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">DependencyInjectionSample.Interfaces</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DependencyInjectionSample.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CharacterRepository</span> <span class="p">:</span> <span class="n">ICharacterRepository</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ApplicationDbContext</span> <span class="n">_dbContext</span><span class="p">;</span>
</span>
<span class="hll">        <span class="k">public</span> <span class="nf">CharacterRepository</span><span class="p">(</span><span class="n">ApplicationDbContext</span> <span class="n">dbContext</span><span class="p">)</span>
</span><span class="hll">        <span class="p">{</span>
</span><span class="hll">            <span class="n">_dbContext</span> <span class="p">=</span> <span class="n">dbContext</span><span class="p">;</span>
</span><span class="hll">        <span class="p">}</span>
</span>
        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Character</span><span class="p">&gt;</span> <span class="n">ListAll</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_dbContext</span><span class="p">.</span><span class="n">Characters</span><span class="p">.</span><span class="n">AsEnumerable</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="n">Character</span> <span class="n">character</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_dbContext</span><span class="p">.</span><span class="n">Characters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
            <span class="n">_dbContext</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">CharacterRepository</span></code> requests an <code class="docutils literal"><span class="pre">ApplicationDbContext</span></code> in its constructor. It is not unusual for dependency injection to be used in a chained fashion like this, with each requested dependency in turn requesting its own dependencies. The container is responsible for resolving all of the dependencies in the graph and returning the fully resolved service.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Creating the requested object, and all of the objects it requires, and all of the objects those require, is sometimes referred to as an <cite>object graph</cite>. Likewise, the collective set of dependencies that must be resolved is typically referred to as a <cite>dependency tree</cite> or <cite>dependency graph</cite>.</p>
</div>
<p>In this case, both <code class="docutils literal"><span class="pre">ICharacterRepository</span></code> and in turn <code class="docutils literal"><span class="pre">ApplicationDbContext</span></code> must be registered with the services container in <code class="docutils literal"><span class="pre">ConfigureServices</span></code> in <code class="docutils literal"><span class="pre">Startup</span></code>. <code class="docutils literal"><span class="pre">ApplicationDbContext</span></code> is configured with the call to the extension method <code class="docutils literal"><span class="pre">AddDbContext&lt;T&gt;</span></code>. The following code shows the registration of the <code class="docutils literal"><span class="pre">CharacterRepository</span></code> type.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
</span><span class="hll">        <span class="n">options</span><span class="p">.</span><span class="n">UseInMemoryDatabase</span><span class="p">()</span>
</span><span class="hll">    <span class="p">);</span>
</span>
    <span class="c1">// Add framework services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>

    <span class="c1">// Register application services.</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">ICharacterRepository</span><span class="p">,</span> <span class="n">CharacterRepository</span><span class="p">&gt;();</span>
</span>    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IOperationTransient</span><span class="p">,</span> <span class="n">Operation</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IOperationScoped</span><span class="p">,</span> <span class="n">Operation</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IOperationSingleton</span><span class="p">,</span> <span class="n">Operation</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IOperationSingletonInstance</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">Operation</span><span class="p">(</span><span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">));</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">OperationService</span><span class="p">,</span> <span class="n">OperationService</span><span class="p">&gt;();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Entity Framework contexts should be added to the services container using the <code class="docutils literal"><span class="pre">Scoped</span></code> lifetime. This is taken care of automatically if you use the helper methods as shown above. Repositories that will make use of Entity Framework should use the same lifetime.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The main danger to be wary of is resolving a <code class="docutils literal"><span class="pre">Scoped</span></code> service from a singleton. It&#8217;s likely in such a case that the service will have incorrect state when processing subsequent requests.</p>
</div>
</div>
<div class="section" id="service-lifetimes-and-registration-options">
<h2><a class="toc-backref" href="#id8">Service Lifetimes and Registration Options</a><a class="headerlink" href="#service-lifetimes-and-registration-options" title="Permalink to this headline">Â¶</a></h2>
<p>ASP.NET services can be configured with the following lifetimes:</p>
<dl class="docutils">
<dt>Transient</dt>
<dd>Transient lifetime services are created each time they are requested. This lifetime works best for lightweight, stateless services.</dd>
<dt>Scoped</dt>
<dd>Scoped lifetime services are created once per request.</dd>
<dt>Singleton</dt>
<dd>Singleton lifetime services are created the first time they are requested (or when <code class="docutils literal"><span class="pre">ConfigureServices</span></code> is run if you specify an instance there) and then every subsequent request will use the same instance. If your application requires singleton behavior, allowing the services container to manage the service&#8217;s lifetime is recommended instead of implementing the singleton design pattern and managing your object&#8217;s lifetime in the class yourself.</dd>
</dl>
<p>Services can be registered with the container in several ways. We have already seen how to register a service implementation with a given type by specifying the concrete type to use. In addition, a factory can be specified, which will then be used to create the instance on demand. The third approach is to directly specify the instance of the type to use, in which case the container will never attempt to create an instance.</p>
<p>To demonstrate the difference between these lifetime and registration options, consider a simple interface that represents one or more tasks as an <em>operation</em> with a unique identifier, <code class="docutils literal"><span class="pre">OperationId</span></code>. Depending on how we configure the lifetime for this service, the container will provide either the same or different instances of the service to the requesting class. To make it clear which lifetime is being requested, we will create one type per lifetime option:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DependencyInjectionSample.Interfaces</span>
<span class="p">{</span>
<span class="hll">    <span class="k">public</span> <span class="k">interface</span> <span class="n">IOperation</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">Guid</span> <span class="n">OperationId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>

    <span class="k">public</span> <span class="k">interface</span> <span class="n">IOperationTransient</span> <span class="p">:</span> <span class="n">IOperation</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">IOperationScoped</span> <span class="p">:</span> <span class="n">IOperation</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">IOperationSingleton</span> <span class="p">:</span> <span class="n">IOperation</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="n">IOperationSingletonInstance</span> <span class="p">:</span> <span class="n">IOperation</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We implement these interfaces using a single class, <code class="docutils literal"><span class="pre">Operation</span></code>, that accepts a <code class="docutils literal"><span class="pre">Guid</span></code> in its constructor, or uses a new <code class="docutils literal"><span class="pre">Guid</span></code> if none is provided.</p>
<p>Next, in <code class="docutils literal"><span class="pre">ConfigureServices</span></code>, each type is added to the container according to its named lifetime:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IOperationTransient</span><span class="p">,</span> <span class="n">Operation</span><span class="p">&gt;();</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IOperationScoped</span><span class="p">,</span> <span class="n">Operation</span><span class="p">&gt;();</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IOperationSingleton</span><span class="p">,</span> <span class="n">Operation</span><span class="p">&gt;();</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IOperationSingletonInstance</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">Operation</span><span class="p">(</span><span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">));</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">OperationService</span><span class="p">,</span> <span class="n">OperationService</span><span class="p">&gt;();</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal"><span class="pre">IOperationSingletonInstance</span></code> service is using a specific instance with a known ID of <code class="docutils literal"><span class="pre">Guid.Empty</span></code> so it will be clear when this type is in use. We have also registered an <code class="docutils literal"><span class="pre">OperationService</span></code> that depends on each of the other <code class="docutils literal"><span class="pre">Operation</span></code> types, so that it will be clear within a request whether this service is getting the same instance as the controller, or a new one, for each operation type. All this service does is expose its dependencies as properties, so they can be displayed in the view.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">DependencyInjectionSample.Interfaces</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DependencyInjectionSample.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OperationService</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">IOperationTransient</span> <span class="n">TransientOperation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">IOperationScoped</span> <span class="n">ScopedOperation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">IOperationSingleton</span> <span class="n">SingletonOperation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">IOperationSingletonInstance</span> <span class="n">SingletonInstanceOperation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">OperationService</span><span class="p">(</span><span class="n">IOperationTransient</span> <span class="n">transientOperation</span><span class="p">,</span>
            <span class="n">IOperationScoped</span> <span class="n">scopedOperation</span><span class="p">,</span>
            <span class="n">IOperationSingleton</span> <span class="n">singletonOperation</span><span class="p">,</span>
            <span class="n">IOperationSingletonInstance</span> <span class="n">instanceOperation</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TransientOperation</span> <span class="p">=</span> <span class="n">transientOperation</span><span class="p">;</span>
            <span class="n">ScopedOperation</span> <span class="p">=</span> <span class="n">scopedOperation</span><span class="p">;</span>
            <span class="n">SingletonOperation</span> <span class="p">=</span> <span class="n">singletonOperation</span><span class="p">;</span>
            <span class="n">SingletonInstanceOperation</span> <span class="p">=</span> <span class="n">instanceOperation</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To demonstrate the object lifetimes within and between separate individual requests to the application, the sample includes an <code class="docutils literal"><span class="pre">OperationsController</span></code> that requests each kind of <code class="docutils literal"><span class="pre">IOperation</span></code> type as well as an <code class="docutils literal"><span class="pre">OperationService</span></code>. The <code class="docutils literal"><span class="pre">Index</span></code> action then displays all of the controller&#8217;s and service&#8217;s <code class="docutils literal"><span class="pre">OperationId</span></code> values.</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">DependencyInjectionSample.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">DependencyInjectionSample.Services</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">DependencyInjectionSample.Controllers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OperationsController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">OperationService</span> <span class="n">_operationService</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOperationTransient</span> <span class="n">_transientOperation</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOperationScoped</span> <span class="n">_scopedOperation</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOperationSingleton</span> <span class="n">_singletonOperation</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IOperationSingletonInstance</span> <span class="n">_singletonInstanceOperation</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">OperationsController</span><span class="p">(</span><span class="n">OperationService</span> <span class="n">operationService</span><span class="p">,</span>
            <span class="n">IOperationTransient</span> <span class="n">transientOperation</span><span class="p">,</span>
            <span class="n">IOperationScoped</span> <span class="n">scopedOperation</span><span class="p">,</span>
            <span class="n">IOperationSingleton</span> <span class="n">singletonOperation</span><span class="p">,</span>
            <span class="n">IOperationSingletonInstance</span> <span class="n">singletonInstanceOperation</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_operationService</span> <span class="p">=</span> <span class="n">operationService</span><span class="p">;</span>
            <span class="n">_transientOperation</span> <span class="p">=</span> <span class="n">transientOperation</span><span class="p">;</span>
            <span class="n">_scopedOperation</span> <span class="p">=</span> <span class="n">scopedOperation</span><span class="p">;</span>
            <span class="n">_singletonOperation</span> <span class="p">=</span> <span class="n">singletonOperation</span><span class="p">;</span>
            <span class="n">_singletonInstanceOperation</span> <span class="p">=</span> <span class="n">singletonInstanceOperation</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// viewbag contains controller-requested services</span>
            <span class="n">ViewBag</span><span class="p">.</span><span class="n">Transient</span> <span class="p">=</span> <span class="n">_transientOperation</span><span class="p">;</span>
            <span class="n">ViewBag</span><span class="p">.</span><span class="n">Scoped</span> <span class="p">=</span> <span class="n">_scopedOperation</span><span class="p">;</span>
            <span class="n">ViewBag</span><span class="p">.</span><span class="n">Singleton</span> <span class="p">=</span> <span class="n">_singletonOperation</span><span class="p">;</span>
            <span class="n">ViewBag</span><span class="p">.</span><span class="n">SingletonInstance</span> <span class="p">=</span> <span class="n">_singletonInstanceOperation</span><span class="p">;</span>
            
            <span class="c1">// operation service has its own requested services</span>
            <span class="n">ViewBag</span><span class="p">.</span><span class="n">Service</span> <span class="p">=</span> <span class="n">_operationService</span><span class="p">;</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now two separate requests are made to this controller action:</p>
<img alt="../_images/lifetimes_request1.png" src="../_images/lifetimes_request1.png" />
<img alt="../_images/lifetimes_request2.png" src="../_images/lifetimes_request2.png" />
<p>Observe which of the <code class="docutils literal"><span class="pre">OperationId</span></code> values varies within a request, and between requests.</p>
<ul class="simple">
<li><em>Transient</em> objects are always different; a new instance is provided to every controller and every service.</li>
<li><em>Scoped</em> objects are the same within a request, but different across different requests</li>
<li><em>Singleton</em> objects are the same for every object and every request (regardless of whether an instance is provided in <code class="docutils literal"><span class="pre">ConfigureServices</span></code>)</li>
</ul>
</div>
<div class="section" id="request-services">
<h2><a class="toc-backref" href="#id9">Request Services</a><a class="headerlink" href="#request-services" title="Permalink to this headline">Â¶</a></h2>
<p>The services available within an ASP.NET request from <code class="docutils literal"><span class="pre">HttpContext</span></code> are exposed through the <code class="docutils literal"><span class="pre">RequestServices</span></code> collection.</p>
<img alt="../_images/request-services.png" src="../_images/request-services.png" />
<p>Request Services represent the services you configure and request as part of your application. When your objects specify dependencies, these are satisfied by the types found in <code class="docutils literal"><span class="pre">RequestServices</span></code>, not <code class="docutils literal"><span class="pre">ApplicationServices</span></code>.</p>
<p>Generally, you shouldn&#8217;t use these properties directly, preferring instead to request the types your classes you require via your class&#8217;s constructor, and letting the framework inject these dependencies. This yields classes that are easier to test (see <a class="reference internal" href="../testing/index.html"><span class="doc">Testing</span></a>) and are more loosely coupled.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prefer requesting dependencies as constructor parameters to accessing the <code class="docutils literal"><span class="pre">RequestServices</span></code> collection.</p>
</div>
</div>
<div class="section" id="designing-your-services-for-dependency-injection">
<h2><a class="toc-backref" href="#id10">Designing Your Services For Dependency Injection</a><a class="headerlink" href="#designing-your-services-for-dependency-injection" title="Permalink to this headline">Â¶</a></h2>
<p>You should design your services to use dependency injection to get their collaborators. This means avoiding the use of stateful static method calls (which result in a code smell known as <a class="reference external" href="http://deviq.com/static-cling/">static cling</a>) and the direct instantiation of dependent classes within your services. It may help to remember the phrase, <a class="reference external" href="http://ardalis.com/new-is-glue">New is Glue</a>, when choosing whether to instantiate a type or to request it via dependency injection. By following the <a class="reference external" href="http://deviq.com/solid/">SOLID Principles of Object Oriented Design</a>, your classes will naturally tend to be small,  well-factored, and easily tested.</p>
<p>What if you find that your classes tend to have way too many dependencies being injected? This is generally a sign that your class is trying to do too much, and is probably violating SRP - the <a class="reference external" href="http://deviq.com/single-responsibility-principle/">Single Responsibility Principle</a>. See if you can refactor the class by moving some of its responsibilities into a new class. Keep in mind that your <code class="docutils literal"><span class="pre">Controller</span></code> classes should be focused on UI concerns, so business rules and data access implementation details should be kept in classes appropriate to these <a class="reference external" href="http://deviq.com/separation-of-concerns/">separate concerns</a>.</p>
<p>With regard to data access specifically, you can easily inject Entity Framework <code class="docutils literal"><span class="pre">DbContext</span></code> types into your controllers, assuming you&#8217;ve configured EF in your <code class="docutils literal"><span class="pre">Startup</span></code> class. However, it is best to avoid depending directly on <code class="docutils literal"><span class="pre">DbContext</span></code> in your UI project. Instead, depend on an abstraction (like a Repository interface), and restrict knowledge of EF (or any other specific data access technology) to the implementation of this interface. This will reduce the coupling between your application and a particular data access strategy, and will make testing your application code much easier.</p>
</div>
<div class="section" id="replacing-the-default-services-container">
<span id="id1"></span><h2><a class="toc-backref" href="#id11">Replacing the default services container</a><a class="headerlink" href="#replacing-the-default-services-container" title="Permalink to this headline">Â¶</a></h2>
<p>The built-in services container is mean to serve the basic needs of the framework and most consumer applications built on it. However, developers who wish to replace the built-in container with their preferred container can easily do so. The <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method typically returns <code class="docutils literal"><span class="pre">void</span></code>, but if its signature is changed to return <code class="docutils literal"><span class="pre">IServiceProvider</span></code>, a different container can be configured and returned. There are many IOC containers available for .NET. In this example, the <a class="reference external" href="http://autofac.org/">Autofac</a> package is used.</p>
<p>First, add the appropriate container package(s) to the dependencies property in project.json:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;dependencies&quot;</span> <span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;Autofac&quot;</span><span class="o">:</span> <span class="s2">&quot;4.0.0-rc2-237&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Autofac.Extensions.DependencyInjection&quot;</span><span class="o">:</span> <span class="s2">&quot;4.0.0-rc2-200&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Next, configure the container in <code class="docutils literal"><span class="pre">ConfigureServices</span></code> and return an <code class="docutils literal"><span class="pre">IServiceProvider</span></code>:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="hll"><span class="k">public</span> <span class="n">IServiceProvider</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
</span><span class="p">{</span>
  <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>
  <span class="c1">// add other framework services</span>

  <span class="c1">// Add Autofac</span>
  <span class="kt">var</span> <span class="n">containerBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ContainerBuilder</span><span class="p">();</span>
  <span class="n">containerBuilder</span><span class="p">.</span><span class="n">RegisterModule</span><span class="p">&lt;</span><span class="n">DefaultModule</span><span class="p">&gt;();</span>
  <span class="n">containerBuilder</span><span class="p">.</span><span class="n">Populate</span><span class="p">(</span><span class="n">services</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="n">containerBuilder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="hll">  <span class="k">return</span> <span class="n">container</span><span class="p">.</span><span class="n">Resolve</span><span class="p">&lt;</span><span class="n">IServiceProvider</span><span class="p">&gt;();</span>
</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using a third-party DI container, you must change <code class="docutils literal"><span class="pre">ConfigureServices</span></code> so that it returns <code class="docutils literal"><span class="pre">IServiceProvider</span></code> instead of <code class="docutils literal"><span class="pre">void</span></code>.</p>
</div>
<p>Finally, configure Autofac as normal in <code class="docutils literal"><span class="pre">DefaultModule</span></code>:</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">DefaultModule</span> <span class="p">:</span> <span class="n">Module</span>
<span class="p">{</span>
  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Load</span><span class="p">(</span><span class="n">ContainerBuilder</span> <span class="n">builder</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">RegisterType</span><span class="p">&lt;</span><span class="n">CharacterRepository</span><span class="p">&gt;().</span><span class="n">As</span><span class="p">&lt;</span><span class="n">ICharacterRepository</span><span class="p">&gt;();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At runtime, Autofac will be used to resolve types and inject dependencies. <a class="reference external" href="http://docs.autofac.org/en/latest/integration/aspnetcore.html">Learn more about using Autofac and ASP.NET Core</a></p>
</div>
<div class="section" id="recommendations">
<h2><a class="toc-backref" href="#id12">Recommendations</a><a class="headerlink" href="#recommendations" title="Permalink to this headline">Â¶</a></h2>
<p>When working with dependency injection, keep the following recommendations in mind:</p>
<ul class="simple">
<li>DI is for objects that have complex dependencies. Controllers, services, adapters, and repositories are all examples of objects that might be added to DI.</li>
<li>Avoid storing data and configuration directly in DI. For example, a user&#8217;s shopping cart shouldn&#8217;t typically be added to the services container. Configuration should use the <a class="reference internal" href="configuration.html#options-config-objects"><span class="std std-ref">Options Model</span></a>. Similarly, avoid &#8220;data holder&#8221; objects that only exist to allow access to some other object. It&#8217;s better to request the actual item needed via DI, if possible.</li>
<li>Avoid static access to services.</li>
<li>Avoid service location in your application code.</li>
<li>Avoid static access to <code class="docutils literal"><span class="pre">HttpContext</span></code>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Like all sets of recommendations, you may encounter situations where ignoring one is required. We have found exceptions to be rare &#8211; mostly very special cases within the framework itself.</p>
</div>
<p>Remember, dependency injection is an <em>alternative</em> to static/global object access patterns. You will not be able to realize the benefits of DI if you mix it with static object access.</p>
</div>
<div class="section" id="additional-resources">
<h2><a class="toc-backref" href="#id13">Additional Resources</a><a class="headerlink" href="#additional-resources" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="startup.html"><span class="doc">Application Startup</span></a></li>
<li><a class="reference internal" href="../testing/index.html"><span class="doc">Testing</span></a></li>
<li><a class="reference external" href="https://msdn.microsoft.com/en-us/magazine/mt703433.aspx">Writing Clean Code in ASP.NET Core with Dependency Injection (MSDN)</a></li>
<li><a class="reference external" href="http://blogs.msdn.com/b/nblumhardt/archive/2008/12/27/container-managed-application-design-prelude-where-does-the-container-belong.aspx">Container-Managed Application Design, Prelude: Where does the Container Belong?</a></li>
<li><a class="reference external" href="http://deviq.com/explicit-dependencies-principle/">Explicit Dependencies Principle</a></li>
<li><a class="reference external" href="http://www.martinfowler.com/articles/injection.html">Inversion of Control Containers and the Dependency Injection Pattern</a> (Fowler)</li>
</ul>
</div>
</div>



  
  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Is this page helpful?</h2>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Is this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">âœ–</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages helpfulness-error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>
  

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
    <!-- disqus -->
    <button id="showComments" type="button" class="btn btn-neutral"><i class="fa fa-comment"></i> Show comments</button>
    <div id="disqus_thread"></div>
    <hr/>
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="environments.html" class="btn btn-neutral float-right" title="Working with Multiple Environments" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="file-providers.html" class="btn btn-neutral" title="ðŸ”§ File Providers" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft.
      Last updated on Jun 21, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  Documentation licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/helpfulness.js?v=6"></script>
      <script type="text/javascript" src="../_static/disqus.js?v=6"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>